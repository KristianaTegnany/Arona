{"version":3,"sources":["../node_modules/ytdl-getinfo/updater.js"],"names":["fs","require","path","request","execFile","updateBinary","Promise","resolve","reject","bin","process","platform","dest","join","__dirname","get","on","e","setTimeout","error","stdout","stderr","length","pipe","createWriteStream","mode","main","module","console","log","then","version","exit","catch","exports"],"mappings":"AAAA,MAAMA,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAlB;;AACA,MAAMC,IAAI,GAAGD,OAAO,CAAC,MAAD,CAApB;;AACA,MAAME,OAAO,GAAGF,OAAO,CAAC,SAAD,CAAvB;;AACA,MAAM;AAAEG,EAAAA;AAAF,IAAeH,OAAO,CAAC,eAAD,CAA5B;AAEA;;;;;;AAIA,SAASI,YAAT,GAAyB;AACvB,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,UAAMC,GAAG,GAAI,aAAYC,OAAO,CAACC,QAAR,KAAqB,OAArB,GAA+B,MAA/B,GAAwC,EAAG,EAApE;AACA,UAAMC,IAAI,GAAGV,IAAI,CAACW,IAAL,CAAUC,SAAV,EAAsB,MAAtB,EAA6BL,GAA7B,CAAb,CAFsC,CAItC;;AACAN,IAAAA,OAAO,CAACY,GAAR,CAAa,sCAAqCN,GAAI,EAAtD,EACCO,EADD,CACI,OADJ,EACaC,CAAC,IAAIT,MAAM,CAACS,CAAD,CADxB,EAC6B;AAD7B,KAECD,EAFD,CAEI,KAFJ,EAEW,MAAME,UAAU,CAAC,MAAM;AAChC;AACAd,MAAAA,QAAQ,CAACQ,IAAD,EAAO,CAAC,WAAD,CAAP,EAAsB,CAACO,KAAD,EAAQC,MAAR,EAAgBC,MAAhB,KAA2B;AACvD,YAAIF,KAAK,IAAIE,MAAM,CAACC,MAApB,EAA4B,OAAOd,MAAM,CAACW,KAAK,IAAIE,MAAV,CAAb;AAC5Bd,QAAAA,OAAO,CAACa,MAAD,CAAP;AACD,OAHO,CAAR;AAID,KAN0B,EAMxB,IANwB,CAF3B,EASCG,IATD,CASMvB,EAAE,CAACwB,iBAAH,CAAqBZ,IAArB,EAA2B;AAAEa,MAAAA,IAAI,EAAE;AAAR,KAA3B,CATN;AAUD,GAfM,CAAP;AAgBD;;AAED,IAAIxB,OAAO,CAACyB,IAAR,KAAiBC,MAArB,EAA6B;AAC3B;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAY,8CAAZ;AACAxB,EAAAA,YAAY,GAAGyB,IAAf,CAAoBC,OAAO,IAAI;AAC7BH,IAAAA,OAAO,CAACC,GAAR,CAAa,sCAAqCE,OAAQ,EAA1D;AACArB,IAAAA,OAAO,CAACsB,IAAR;AACD,GAHD,EAGGC,KAHH,CAGShB,CAAC,IAAI;AACZW,IAAAA,OAAO,CAACT,KAAR,CAAcF,CAAd;AACAP,IAAAA,OAAO,CAACsB,IAAR,CAAa,CAAb;AACD,GAND;AAOD,CAVD,MAUO;AACL;AACAL,EAAAA,MAAM,CAACO,OAAP,GAAiB7B,YAAjB;AACD","sourcesContent":["const fs = require('fs')\nconst path = require('path')\nconst request = require('request')\nconst { execFile } = require('child_process')\n\n/**\n * Updates or downloads the youtube-dl binary.\n * @return {Promise<String>} - New version number\n */\nfunction updateBinary () {\n  return new Promise((resolve, reject) => {\n    const bin = `youtube-dl${process.platform === 'win32' ? '.exe' : ''}`\n    const dest = path.join(__dirname, `ytdl`, bin)\n\n    // Get the latest version\n    request.get(`https://yt-dl.org/downloads/latest/${bin}`)\n    .on('error', e => reject(e)) // Handle errors\n    .on('end', () => setTimeout(() => {\n      // Try to get the version number\n      execFile(dest, ['--version'], (error, stdout, stderr) => {\n        if (error || stderr.length) return reject(error || stderr)\n        resolve(stdout)\n      })\n    }, 1000))\n    .pipe(fs.createWriteStream(dest, { mode: 0o755 }))\n  })\n}\n\nif (require.main === module) {\n  // CLI\n  console.log('Updating youtube-dl to the latest version...')\n  updateBinary().then(version => {\n    console.log(`Successfully downloaded youtube-dl ${version}`)\n    process.exit()\n  }).catch(e => {\n    console.error(e)\n    process.exit(1)\n  })\n} else {\n  // Module\n  module.exports = updateBinary\n}\n"],"file":"updater.js"}