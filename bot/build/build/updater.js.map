{"version":3,"sources":["../node_modules/ytdl-getinfo/updater.js"],"names":["fs","require","path","request","execFile","bin","process","dest","e","reject","setTimeout","error","stderr","resolve","mode","console","updateBinary","version","module"],"mappings":";;AAAA,IAAMA,EAAE,GAAGC,OAAO,CAAlB,IAAkB,CAAlB;;AACA,IAAMC,IAAI,GAAGD,OAAO,CAApB,MAAoB,CAApB;;AACA,IAAME,OAAO,GAAGF,OAAO,CAAvB,SAAuB,CAAvB;;eACqBA,OAAO,CAA5B,eAA4B,C;IAApBG,Q,YAAAA,Q;AAER;;;;;;AAIA,SAAA,YAAA,GAAyB;AACvB,SAAO,IAAA,OAAA,CAAY,UAAA,OAAA,EAAA,MAAA,EAAqB;AACtC,QAAMC,GAAG,uBAAgBC,OAAO,CAAPA,QAAAA,KAAAA,OAAAA,GAAAA,MAAAA,GAAzB,EAAS,CAAT;AACA,QAAMC,IAAI,GAAGL,IAAI,CAAJA,IAAAA,CAAAA,SAAAA,UAFyB,GAEzBA,CAAb,CAFsC,CAItC;;AACAC,IAAAA,OAAO,CAAPA,GAAAA,8CAAAA,GAAAA,GAAAA,EAAAA,CAAAA,OAAAA,EACaK,UAAAA,CAAC;AAAA,aAAIC,MAAM,CADxBN,CACwB,CAAV;AAAA,KADdA,EAC6B;AAD7BA,KAAAA,EAAAA,CAAAA,KAAAA,EAEW;AAAA,aAAMO,UAAU,CAAC,YAAM;AAChC;AACAN,QAAAA,QAAQ,CAAA,IAAA,EAAO,CAAP,WAAO,CAAP,EAAsB,UAAA,KAAA,EAAA,MAAA,EAAA,MAAA,EAA2B;AACvD,cAAIO,KAAK,IAAIC,MAAM,CAAnB,MAAA,EAA4B,OAAOH,MAAM,CAACE,KAAK,IAAnB,MAAa,CAAb;AAC5BE,UAAAA,OAAO,CAAPA,MAAO,CAAPA;AAFFT,SAAQ,CAARA;AAFyB,OAAA,EAF3BD,IAE2B,CAAhB;AAAA,KAFXA,EAAAA,IAAAA,CASM,EAAE,CAAF,iBAAA,CAAA,IAAA,EAA2B;AAAEW,MAAAA,IAAI,EAAE;AAAR,KAA3B,CATNX;AALF,GAAO,CAAP;AAgBD;;AAED,IAAIF,OAAO,CAAPA,IAAAA,KAAJ,MAAA,EAA6B;AAC3B;AACAc,EAAAA,OAAO,CAAPA,GAAAA,CAAAA,8CAAAA;AACAC,EAAAA,YAAY,GAAZA,IAAAA,CAAoBC,UAAAA,OAAO,EAAI;AAC7BF,IAAAA,OAAO,CAAPA,GAAAA,8CAAAA,OAAAA;AACAT,IAAAA,OAAO,CAAPA,IAAAA;AAFFU,GAAAA,WAGSR,UAAAA,CAAC,EAAI;AACZO,IAAAA,OAAO,CAAPA,KAAAA,CAAAA,CAAAA;AACAT,IAAAA,OAAO,CAAPA,IAAAA,CAAAA,CAAAA;AALFU,GAAAA;AAHF,CAAA,MAUO;AACL;AACAE,EAAAA,MAAM,CAANA,OAAAA,GAAAA,YAAAA;AACD","sourcesContent":["const fs = require('fs')\nconst path = require('path')\nconst request = require('request')\nconst { execFile } = require('child_process')\n\n/**\n * Updates or downloads the youtube-dl binary.\n * @return {Promise<String>} - New version number\n */\nfunction updateBinary () {\n  return new Promise((resolve, reject) => {\n    const bin = `youtube-dl${process.platform === 'win32' ? '.exe' : ''}`\n    const dest = path.join(__dirname, `ytdl`, bin)\n\n    // Get the latest version\n    request.get(`https://yt-dl.org/downloads/latest/${bin}`)\n    .on('error', e => reject(e)) // Handle errors\n    .on('end', () => setTimeout(() => {\n      // Try to get the version number\n      execFile(dest, ['--version'], (error, stdout, stderr) => {\n        if (error || stderr.length) return reject(error || stderr)\n        resolve(stdout)\n      })\n    }, 1000))\n    .pipe(fs.createWriteStream(dest, { mode: 0o755 }))\n  })\n}\n\nif (require.main === module) {\n  // CLI\n  console.log('Updating youtube-dl to the latest version...')\n  updateBinary().then(version => {\n    console.log(`Successfully downloaded youtube-dl ${version}`)\n    process.exit()\n  }).catch(e => {\n    console.error(e)\n    process.exit(1)\n  })\n} else {\n  // Module\n  module.exports = updateBinary\n}\n"],"file":"updater.js"}