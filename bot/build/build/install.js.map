{"version":3,"sources":["../node_modules/phantomjs/install.js"],"names":["requestProgress","require","progress","extractZip","cp","fs","hasha","helper","kew","path","request","url","which","originalPath","process","DEFAULT_CDN","validExit","console","exit","libPath","pkgPath","phantomPath","copyIntoPlace","location","getTargetPlatform","err","relativeLocation","writeLocationFile","platform","arch","getTargetArch","contents","code","now","Date","candidateTmpDirs","i","candidatePath","testFile","e","strictSSL","options","uri","getDownloadUrl","encoding","followRedirect","headers","proxyUrl","proxy","ca","error","deferred","writePath","filePath","bar","response","Math","body","JSON","handleRequestError","total","state","width","extractedPath","cwd","dir","files","file","libModule","resolvedLocation","getLocationInLibModuleIfMatching","globalLocation","spec","getDownloadSpec","cdnUrl","downloadUrl","checksum","downloadSpec","tmpPath","findSuitableTempDirectory","fileName","downloadedFile","verifyChecksum","requestBinary","getRequestOptions","algorithm","result","version","stdout"],"mappings":"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","sourcesContent":["// Copyright 2012 The Obvious Corporation.\n\n/*\n * This simply fetches the right version of phantom for the current platform.\n */\n\n'use strict'\n\nvar requestProgress = require('request-progress')\nvar progress = require('progress')\nvar extractZip = require('extract-zip')\nvar cp = require('child_process')\nvar fs = require('fs-extra')\nvar hasha = require('hasha')\nvar helper = require('./lib/phantomjs')\nvar kew = require('kew')\nvar path = require('path')\nvar request = require('request')\nvar url = require('url')\nvar which = require('which')\n\nvar originalPath = process.env.PATH\nvar DEFAULT_CDN = 'https://github.com/Medium/phantomjs/releases/download/v1.9.19'\n\n// If the process exits without going through exit(), then we did not complete.\nvar validExit = false\n\nprocess.on('exit', function () {\n  if (!validExit) {\n    console.log('Install exited unexpectedly')\n    exit(1)\n  }\n})\n\n// NPM adds bin directories to the path, which will cause `which` to find the\n// bin for this package not the actual phantomjs bin.  Also help out people who\n// put ./bin on their path\nprocess.env.PATH = helper.cleanPath(originalPath)\n\nvar libPath = path.join(__dirname, 'lib')\nvar pkgPath = path.join(libPath, 'phantom')\nvar phantomPath = null\n\n// If the user manually installed PhantomJS, we want\n// to use the existing version.\n//\n// Do not re-use a manually-installed PhantomJS with\n// a different version.\n//\n// Do not re-use an npm-installed PhantomJS, because\n// that can lead to weird circular dependencies between\n// local versions and global versions.\n// https://github.com/Obvious/phantomjs/issues/85\n// https://github.com/Medium/phantomjs/pull/184\nkew.resolve(true)\n  .then(tryPhantomjsInLib)\n  .then(tryPhantomjsOnPath)\n  .then(downloadPhantomjs)\n  .then(extractDownload)\n  .then(function (extractedPath) {\n    return copyIntoPlace(extractedPath, pkgPath)\n  })\n  .then(function () {\n    var location = getTargetPlatform() === 'win32' ?\n        path.join(pkgPath, 'phantomjs.exe') :\n        path.join(pkgPath, 'bin' ,'phantomjs')\n\n    try {\n      // Ensure executable is executable by all users\n      fs.chmodSync(location, '755')\n    } catch (err) {\n      if (err.code == 'ENOENT') {\n        console.error('chmod failed: phantomjs was not successfully copied to', location)\n        exit(1)\n      }\n      throw err\n    }\n\n    var relativeLocation = path.relative(libPath, location)\n    writeLocationFile(relativeLocation)\n\n    console.log('Done. Phantomjs binary available at', location)\n    exit(0)\n  })\n  .fail(function (err) {\n    console.error('Phantom installation failed', err, err.stack)\n    exit(1)\n  })\n\n\nfunction writeLocationFile(location) {\n  console.log('Writing location.js file')\n  if (getTargetPlatform() === 'win32') {\n    location = location.replace(/\\\\/g, '\\\\\\\\')\n  }\n\n  var platform = getTargetPlatform()\n  var arch = getTargetArch()\n\n  var contents = 'module.exports.location = \"' + location + '\"\\n'\n\n  if (/^[a-zA-Z0-9]*$/.test(platform) && /^[a-zA-Z0-9]*$/.test(arch)) {\n    contents +=\n        'module.exports.platform = \"' + getTargetPlatform() + '\"\\n' +\n        'module.exports.arch = \"' + getTargetArch() + '\"\\n'\n  }\n\n  fs.writeFileSync(path.join(libPath, 'location.js'), contents)\n}\n\nfunction exit(code) {\n  validExit = true\n  process.env.PATH = originalPath\n  process.exit(code || 0)\n}\n\n\nfunction findSuitableTempDirectory() {\n  var now = Date.now()\n  var candidateTmpDirs = [\n    process.env.TMPDIR || process.env.TEMP || process.env.npm_config_tmp,\n    '/tmp',\n    path.join(process.cwd(), 'tmp')\n  ]\n\n  for (var i = 0; i < candidateTmpDirs.length; i++) {\n    var candidatePath = path.join(candidateTmpDirs[i], 'phantomjs')\n\n    try {\n      fs.mkdirsSync(candidatePath, '0777')\n      // Make double sure we have 0777 permissions; some operating systems\n      // default umask does not allow write by default.\n      fs.chmodSync(candidatePath, '0777')\n      var testFile = path.join(candidatePath, now + '.tmp')\n      fs.writeFileSync(testFile, 'test')\n      fs.unlinkSync(testFile)\n      return candidatePath\n    } catch (e) {\n      console.log(candidatePath, 'is not writable:', e.message)\n    }\n  }\n\n  console.error('Can not find a writable tmp directory, please report issue ' +\n      'on https://github.com/Obvious/phantomjs/issues/59 with as much ' +\n      'information as possible.')\n  exit(1)\n}\n\n\nfunction getRequestOptions() {\n  var strictSSL = !!process.env.npm_config_strict_ssl\n  if (process.version == 'v0.10.34') {\n    console.log('Node v0.10.34 detected, turning off strict ssl due to https://github.com/joyent/node/issues/8894')\n    strictSSL = false\n  }\n\n  var options = {\n    uri: getDownloadUrl(),\n    encoding: null, // Get response as a buffer\n    followRedirect: true, // The default download path redirects to a CDN URL.\n    headers: {},\n    strictSSL: strictSSL\n  }\n\n  var proxyUrl = process.env.npm_config_https_proxy ||\n      process.env.npm_config_http_proxy ||\n      process.env.npm_config_proxy\n  if (proxyUrl) {\n\n    // Print using proxy\n    var proxy = url.parse(proxyUrl)\n    if (proxy.auth) {\n      // Mask password\n      proxy.auth = proxy.auth.replace(/:.*$/, ':******')\n    }\n    console.log('Using proxy ' + url.format(proxy))\n\n    // Enable proxy\n    options.proxy = proxyUrl\n  }\n\n  // Use the user-agent string from the npm config\n  options.headers['User-Agent'] = process.env.npm_config_user_agent\n\n  // Use certificate authority settings from npm\n  var ca = process.env.npm_config_ca\n  if (!ca && process.env.npm_config_cafile) {\n    try {\n      ca = fs.readFileSync(process.env.npm_config_cafile, {encoding: 'utf8'})\n        .split(/\\n(?=-----BEGIN CERTIFICATE-----)/g)\n\n      // Comments at the beginning of the file result in the first\n      // item not containing a certificate - in this case the\n      // download will fail\n      if (ca.length > 0 && !/-----BEGIN CERTIFICATE-----/.test(ca[0])) {\n        ca.shift()\n      }\n\n    } catch (e) {\n      console.error('Could not read cafile', process.env.npm_config_cafile, e)\n    }\n  }\n\n  if (ca) {\n    console.log('Using npmconf ca')\n    options.agentOptions = {\n      ca: ca\n    }\n    options.ca = ca\n  }\n\n  return options\n}\n\nfunction handleRequestError(error) {\n  if (error && error.stack && error.stack.indexOf('SELF_SIGNED_CERT_IN_CHAIN') != -1) {\n      console.error('Error making request, SELF_SIGNED_CERT_IN_CHAIN. ' +\n          'Please read https://github.com/Medium/phantomjs#i-am-behind-a-corporate-proxy-that-uses-self-signed-ssl-certificates-to-intercept-encrypted-traffic')\n      exit(1)\n  } else if (error) {\n    console.error('Error making request.\\n' + error.stack + '\\n\\n' +\n        'Please report this full log at https://github.com/Medium/phantomjs')\n    exit(1)\n  } else {\n    console.error('Something unexpected happened, please report this full ' +\n        'log at https://github.com/Medium/phantomjs')\n    exit(1)\n  }\n}\n\nfunction requestBinary(requestOptions, filePath) {\n  var deferred = kew.defer()\n\n  var writePath = filePath + '-download-' + Date.now()\n\n  console.log('Receiving...')\n  var bar = null\n  requestProgress(request(requestOptions, function (error, response, body) {\n    console.log('')\n    if (!error && response.statusCode === 200) {\n      fs.writeFileSync(writePath, body)\n      console.log('Received ' + Math.floor(body.length / 1024) + 'K total.')\n      fs.renameSync(writePath, filePath)\n      deferred.resolve(filePath)\n\n    } else if (response) {\n      console.error('Error requesting archive.\\n' +\n          'Status: ' + response.statusCode + '\\n' +\n          'Request options: ' + JSON.stringify(requestOptions, null, 2) + '\\n' +\n          'Response headers: ' + JSON.stringify(response.headers, null, 2) + '\\n' +\n          'Make sure your network and proxy settings are correct.\\n\\n' +\n          'If you continue to have issues, please report this full log at ' +\n          'https://github.com/Medium/phantomjs')\n      exit(1)\n    } else {\n      handleRequestError(error)\n    }\n  })).on('progress', function (state) {\n    try {\n      if (!bar) {\n        bar = new progress('  [:bar] :percent', {total: state.size.total, width: 40})\n      }\n      bar.curr = state.size.transferred\n      bar.tick()\n    } catch (e) {\n      // It doesn't really matter if the progress bar doesn't update.\n    }\n  })\n  .on('error', handleRequestError)\n\n  return deferred.promise\n}\n\n\nfunction extractDownload(filePath) {\n  var deferred = kew.defer()\n  // extract to a unique directory in case multiple processes are\n  // installing and extracting at once\n  var extractedPath = filePath + '-extract-' + Date.now()\n  var options = {cwd: extractedPath}\n\n  fs.mkdirsSync(extractedPath, '0777')\n  // Make double sure we have 0777 permissions; some operating systems\n  // default umask does not allow write by default.\n  fs.chmodSync(extractedPath, '0777')\n\n  if (filePath.substr(-4) === '.zip') {\n    console.log('Extracting zip contents')\n    extractZip(path.resolve(filePath), {dir: extractedPath}, function(err) {\n      if (err) {\n        console.error('Error extracting zip')\n        deferred.reject(err)\n      } else {\n        deferred.resolve(extractedPath)\n      }\n    })\n\n  } else {\n    console.log('Extracting tar contents (via spawned process)')\n    cp.execFile('tar', ['jxf', path.resolve(filePath)], options, function (err) {\n      if (err) {\n        console.error('Error extracting archive')\n        deferred.reject(err)\n      } else {\n        deferred.resolve(extractedPath)\n      }\n    })\n  }\n  return deferred.promise\n}\n\n\nfunction copyIntoPlace(extractedPath, targetPath) {\n  console.log('Removing', targetPath)\n  return kew.nfcall(fs.remove, targetPath).then(function () {\n    // Look for the extracted directory, so we can rename it.\n    var files = fs.readdirSync(extractedPath)\n    for (var i = 0; i < files.length; i++) {\n      var file = path.join(extractedPath, files[i])\n      if (fs.statSync(file).isDirectory() && file.indexOf(helper.version) != -1) {\n        console.log('Copying extracted folder', file, '->', targetPath)\n        return kew.nfcall(fs.move, file, targetPath)\n      }\n    }\n\n    console.log('Could not find extracted file', files)\n    throw new Error('Could not find extracted file')\n  })\n}\n\nfunction getLocationInLibModuleIfMatching(libPath) {\n  var libModule = require(libPath)\n  if (libModule.location &&\n      getTargetPlatform() == libModule.platform &&\n      getTargetArch() == libModule.arch) {\n    try {\n      var resolvedLocation = path.resolve(path.dirname(libPath), libModule.location)\n      if (fs.statSync(resolvedLocation)) {\n        return resolvedLocation\n      }\n    } catch (e) {\n      // fall through\n    }\n  }\n  return false\n}\n\n/**\n * Check to see if the binary in lib is OK to use. If successful, exit the process.\n */\nfunction tryPhantomjsInLib() {\n  return kew.fcall(function () {\n    var location = getLocationInLibModuleIfMatching('./lib/location.js')\n    if (location) {\n      console.log('PhantomJS is previously installed at', location)\n      exit(0)\n    }\n  }).fail(function () {\n    // silently swallow any errors\n  })\n}\n\n/**\n * Check to see if the binary on PATH is OK to use. If successful, exit the process.\n */\nfunction tryPhantomjsOnPath() {\n  if (getTargetPlatform() != process.platform || getTargetArch() != process.arch) {\n    console.log('Building for target platform ' + getTargetPlatform() + '/' + getTargetArch() +\n                '. Skipping PATH search')\n    return kew.resolve(false)\n  }\n\n  return kew.nfcall(which, 'phantomjs')\n  .then(function (result) {\n    phantomPath = result\n    console.log('Considering PhantomJS found at', phantomPath)\n\n    // Horrible hack to avoid problems during global install. We check to see if\n    // the file `which` found is our own bin script.\n    if (phantomPath.indexOf(path.join('npm', 'phantomjs')) !== -1) {\n      console.log('Looks like an `npm install -g` on windows; skipping installed version.')\n      return\n    }\n\n    var contents = fs.readFileSync(phantomPath, 'utf8')\n    if (/NPM_INSTALL_MARKER/.test(contents)) {\n      console.log('Looks like an `npm install -g`')\n\n      var globalLocation = getLocationInLibModuleIfMatching(\n          path.resolve(fs.realpathSync(phantomPath), '../../lib/location'))\n      if (globalLocation) {\n        console.log('Linking to global install at', globalLocation)\n        writeLocationFile(globalLocation)\n        exit(0)\n      }\n\n      console.log('Could not link global install, skipping...')\n    } else {\n      return checkPhantomjsVersion(phantomPath).then(function (matches) {\n        if (matches) {\n          writeLocationFile(phantomPath)\n          console.log('PhantomJS is already installed on PATH at', phantomPath)\n          exit(0)\n        }\n      })\n    }\n  }, function () {\n    console.log('PhantomJS not found on PATH')\n  })\n  .fail(function (err) {\n    console.error('Error checking path, continuing', err)\n    return false\n  })\n}\n\n/**\n * @return {?string} Get the download URL for phantomjs.\n *     May return null if no download url exists.\n */\nfunction getDownloadUrl() {\n  var spec = getDownloadSpec()\n  return spec && spec.url\n}\n\n/**\n * @return {?{url: string, checksum: string}} Get the download URL and expected\n *     SHA-256 checksum for phantomjs.  May return null if no download url exists.\n */\nfunction getDownloadSpec() {\n  var cdnUrl = process.env.npm_config_phantomjs_cdnurl ||\n      process.env.PHANTOMJS_CDNURL ||\n      DEFAULT_CDN\n  var downloadUrl = cdnUrl + '/phantomjs-' + helper.version + '-'\n  var checksum = ''\n\n  var platform = getTargetPlatform()\n  var arch = getTargetArch()\n  if (platform === 'linux' && arch === 'x64') {\n    downloadUrl += 'linux-x86_64.tar.bz2'\n    checksum = 'a1d9628118e270f26c4ddd1d7f3502a93b48ede334b8585d11c1c3ae7bc7163a'\n  } else if (platform === 'linux' && arch == 'ia32') {\n    downloadUrl += 'linux-i686.tar.bz2'\n    checksum = '4102450bb658157e9aef3e229828fade0aaa0de0663802b31a0edff4b5aedf85'\n  } else if (platform === 'darwin' || platform === 'openbsd' || platform === 'freebsd') {\n    downloadUrl += 'macosx.zip'\n    checksum = '8f15043ae3031815dc5f884ea6ffa053d365491b1bc0dc3a0862d5ff1ac20a48'\n  } else if (platform === 'win32') {\n    downloadUrl += 'windows.zip'\n    checksum = 'da36853ece7d58b6f50813d3e598d8a16bb191b467ac32e1624a239a49de9104'\n  } else {\n    return null\n  }\n  return {url: downloadUrl, checksum: checksum}\n}\n\n/**\n * Download phantomjs, reusing the existing copy on disk if available.\n * Exits immediately if there is no binary to download.\n * @return {Promise.<string>} The path to the downloaded file.\n */\nfunction downloadPhantomjs() {\n  var downloadSpec = getDownloadSpec()\n  if (!downloadSpec) {\n    console.error(\n        'Unexpected platform or architecture: ' + getTargetPlatform() + '/' + getTargetArch() + '\\n' +\n        'It seems there is no binary available for your platform/architecture\\n' +\n        'Try to install PhantomJS globally')\n    exit(1)\n  }\n\n  var downloadUrl = downloadSpec.url\n  var downloadedFile\n\n  return kew.fcall(function () {\n    // Can't use a global version so start a download.\n    var tmpPath = findSuitableTempDirectory()\n    var fileName = downloadUrl.split('/').pop()\n    downloadedFile = path.join(tmpPath, fileName)\n\n    if (fs.existsSync(downloadedFile)) {\n      console.log('Download already available at', downloadedFile)\n      return verifyChecksum(downloadedFile, downloadSpec.checksum)\n    }\n    return false\n  }).then(function (verified) {\n    if (verified) {\n      return downloadedFile\n    }\n\n    // Start the install.\n    console.log('Downloading', downloadUrl)\n    console.log('Saving to', downloadedFile)\n    return requestBinary(getRequestOptions(), downloadedFile)\n  })\n}\n\n/**\n * Check to make sure that the file matches the checksum.\n * @param {string} fileName\n * @param {string} checksum\n * @return {Promise.<boolean>}\n */\nfunction verifyChecksum(fileName, checksum) {\n  return kew.resolve(hasha.fromFile(fileName, {algorithm: 'sha256'})).then(function (hash) {\n    var result = checksum == hash\n    if (result) {\n      console.log('Verified checksum of previously downloaded file')\n    } else {\n      console.log('Checksum did not match')\n    }\n    return result\n  }).fail(function (err) {\n    console.error('Failed to verify checksum: ', err)\n    return false\n  })\n}\n\n/**\n * Check to make sure a given binary is the right version.\n * @return {kew.Promise.<boolean>}\n */\nfunction checkPhantomjsVersion(phantomPath) {\n  console.log('Found PhantomJS at', phantomPath, '...verifying')\n  return kew.nfcall(cp.execFile, phantomPath, ['--version']).then(function (stdout) {\n    var version = stdout.trim()\n    if (helper.version == version) {\n      return true\n    } else {\n      console.log('PhantomJS detected, but wrong version', stdout.trim(), '@', phantomPath + '.')\n      return false\n    }\n  }).fail(function (err) {\n    console.error('Error verifying phantomjs, continuing', err)\n    return false\n  })\n}\n\n/**\n * @return {string}\n */\nfunction getTargetPlatform() {\n  return process.env.PHANTOMJS_PLATFORM || process.platform\n}\n\n/**\n * @return {string}\n */\nfunction getTargetArch() {\n  return process.env.PHANTOMJS_ARCH || process.arch\n}\n"],"file":"install.js"}