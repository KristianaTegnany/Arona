{"version":3,"sources":["../node_modules/tar-stream/pack.js"],"names":["util","require","eos","headers","Readable","Writable","PassThrough","END_OF_TAR","Buffer","fill","noop","overflow","self","size","push","slice","Sink","to","call","written","_to","_destroyed","inherits","prototype","_write","data","enc","cb","length","_drain","destroy","emit","Void","Error","Pack","opts","_finalized","_finalizing","_stream","entry","header","buffer","callback","type","mode","uid","gid","mtime","Date","isBuffer","_encode","process","nextTick","sink","err","finalize","buf","encode","_encodePax","paxHeader","encodePax","name","linkname","newHeader","uname","gname","devmajor","devminor","_read","n","drain","module","exports"],"mappings":"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","sourcesContent":["var util = require('util')\nvar eos = require('end-of-stream')\nvar headers = require('./headers')\n\nvar Readable = require('readable-stream').Readable\nvar Writable = require('readable-stream').Writable\nvar PassThrough = require('readable-stream').PassThrough\n\nvar END_OF_TAR = new Buffer(1024)\nEND_OF_TAR.fill(0)\n\nvar noop = function() {}\n\nvar overflow = function(self, size) {\n  size &= 511\n  if (size) self.push(END_OF_TAR.slice(0, 512 - size))\n}\n\nvar Sink = function(to) {\n  Writable.call(this)\n  this.written = 0\n  this._to = to\n  this._destroyed = false\n}\n\nutil.inherits(Sink, Writable)\n\nSink.prototype._write = function(data, enc, cb) {\n  this.written += data.length\n  if (this._to.push(data)) return cb()\n  this._to._drain = cb\n}\n\nSink.prototype.destroy = function() {\n  if (this._destroyed) return\n  this._destroyed = true\n  this.emit('close')\n}\n\nvar Void = function() {\n  Writable.call(this)\n  this._destroyed = false\n}\n\nutil.inherits(Void, Writable)\n\nVoid.prototype._write = function(data, enc, cb) {\n  cb(new Error('No body allowed for this entry'))\n}\n\nVoid.prototype.destroy = function() {\n  if (this._destroyed) return\n  this._destroyed = true\n  this.emit('close')\n}\n\nvar Pack = function(opts) {\n  if (!(this instanceof Pack)) return new Pack(opts)\n  Readable.call(this, opts)\n\n  this._drain = noop\n  this._finalized = false\n  this._finalizing = false\n  this._destroyed = false\n  this._stream = null\n}\n\nutil.inherits(Pack, Readable)\n\nPack.prototype.entry = function(header, buffer, callback) {\n  if (this._stream) throw new Error('already piping an entry')\n  if (this._finalized || this._destroyed) return\n\n  if (typeof buffer === 'function') {\n    callback = buffer\n    buffer = null\n  }\n\n  if (!callback) callback = noop\n\n  var self = this\n\n  if (!header.size)  header.size = 0\n  if (!header.type)  header.type = 'file'\n  if (!header.mode)  header.mode = header.type === 'directory' ? '0755' : '0644'\n  if (!header.uid)   header.uid = 0\n  if (!header.gid)   header.gid = 0\n  if (!header.mtime) header.mtime = new Date()\n\n  if (typeof buffer === 'string') buffer = new Buffer(buffer)\n  if (Buffer.isBuffer(buffer)) {\n    header.size = buffer.length\n    this._encode(header)\n    this.push(buffer)\n    overflow(self, header.size)\n    process.nextTick(callback)\n    return new Void()\n  }\n  if (header.type !== 'file' && header.type !== 'contigious-file') {\n    this._encode(header)\n    process.nextTick(callback)\n    return new Void()\n  }\n\n  var sink = new Sink(this)\n\n  this._encode(header)\n  this._stream = sink\n\n  eos(sink, function(err) {\n    self._stream = null\n\n    if (err) { // stream was closed\n      self.destroy()\n      return callback(err)\n    }\n\n    if (sink.written !== header.size) { // corrupting tar\n      self.destroy()\n      return callback(new Error('size mismatch'))\n    }\n\n    overflow(self, header.size)\n    if (self._finalizing) self.finalize()\n    callback()\n  })\n\n  return sink\n}\n\nPack.prototype.finalize = function() {\n  if (this._stream) {\n    this._finalizing = true\n    return\n  }\n\n  if (this._finalized) return\n  this._finalized = true\n  this.push(END_OF_TAR)\n  this.push(null)\n}\n\nPack.prototype.destroy = function(err) {\n  if (this._destroyed) return\n  this._destroyed = true\n\n  if (err) this.emit('error', err)\n  this.emit('close')\n  if (this._stream && this._stream.destroy) this._stream.destroy()\n}\n\nPack.prototype._encode = function(header) {\n  var buf = headers.encode(header)\n  if (buf) this.push(buf)\n  else this._encodePax(header)\n}\n\nPack.prototype._encodePax = function(header) {\n  var paxHeader = headers.encodePax({\n    name: header.name,\n    linkname: header.linkname\n  })\n\n  var newHeader = {\n    name: 'PaxHeader',\n    mode: header.mode,\n    uid: header.uid,\n    gid: header.gid,\n    size: paxHeader.length,\n    mtime: header.mtime,\n    type: 'pax-header',\n    linkname: header.linkname && 'PaxHeader',\n    uname: header.uname,\n    gname: header.gname,\n    devmajor: header.devmajor,\n    devminor: header.devminor\n  }\n\n  this.push(headers.encode(newHeader))\n  this.push(paxHeader)\n  overflow(this, paxHeader.length)\n\n  newHeader.size = header.size\n  newHeader.type = header.type\n  this.push(headers.encode(newHeader))\n}\n\nPack.prototype._read = function(n) {\n  var drain = this._drain\n  this._drain = noop\n  drain()\n}\n\nmodule.exports = Pack\n"],"file":"pack.js"}