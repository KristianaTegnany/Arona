{"version":3,"sources":["../node_modules/kew/kew.js"],"names":["Promise","onSuccess","onFail","promise","_isPromise","_successFn","_failFn","_scope","_boundArgs","_hasContext","_nextContext","undefined","_currentContext","nextTick","callback","process","nextTickCallback","defer","scope","args","resolve","apply","thrown","reject","getNextTickFunction","setNextTickFunction","fn","PromiseStats","errorsEmitted","errorsHandled","stats","prototype","_handleError","_errorHandled","_useContext","context","clearContext","setContext","getContext","data","_error","_hasData","Error","i","isPromise","_child","_promises","length","_chainPromise","_onComplete","fin","isPromiseLike","then","bind","err","_data","_withInput","e","_ended","onPromiseThrow","_withError","thenBound","var_args","arguments","Array","slice","call","fail","failBound","spread","allInternal","array","spreadBound","concat","onComplete","push","end","_end","done","onFailure","self","timeout","timeoutMs","timeoutMsg","deferred","isTimeout","setTimeout","clearTimeout","_nextTick","resolver","makeNodeResolver","obj","replaceEl","arr","idx","val","replaceElFulfilled","value","state","replaceElRejected","reason","all","promises","isArray","outputs","finished","counter","decrementAllCounter","onAllError","allSettled","delay","delayMsOrVal","opt_delayMs","returnVal","delayMs","onDelay","ms","fcall","rootArgs","nfcall","splice","ncall","bindPromise","onBoundPromise","module","exports"],"mappings":"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","sourcesContent":["\n/**\n * An object representing a \"promise\" for a future value\n *\n * @param {?function(T, ?)=} onSuccess a function to handle successful\n *     resolution of this promise\n * @param {?function(!Error, ?)=} onFail a function to handle failed\n *     resolution of this promise\n * @constructor\n * @template T\n */\nfunction Promise(onSuccess, onFail) {\n  this.promise = this\n  this._isPromise = true\n  this._successFn = onSuccess\n  this._failFn = onFail\n  this._scope = this\n  this._boundArgs = null\n  this._hasContext = false\n  this._nextContext = undefined\n  this._currentContext = undefined\n}\n\n/**\n * @param {function()} callback\n */\nfunction nextTick (callback) {\n  callback()\n}\n\nif (typeof process !== 'undefined' && typeof process.nextTick === 'function') {\n  nextTick = process.nextTick\n}\n\n/**\n * All callback execution should go through this function.  While the\n * implementation below is simple, it can be replaced with more sophisticated\n * implementations that enforce QoS on the event loop.\n *\n * @param {Promise} defer\n * @param {Function} callback\n * @param {Object|undefined} scope\n * @param {Array} args\n */\nfunction nextTickCallback (defer, callback, scope, args) {\n  try {\n    defer.resolve(callback.apply(scope, args))\n  } catch (thrown) {\n    defer.reject(thrown)\n  }\n}\n\n/**\n * Used for accessing the nextTick function from outside the kew module.\n *\n * @return {Function}\n */\nfunction getNextTickFunction () {\n  return nextTick\n}\n\n/**\n * Used for overriding the nextTick function from outside the kew module so that\n * the user can plug and play lower level schedulers\n * @param {!Function} fn\n */\nfunction setNextTickFunction (fn) {\n  nextTick = fn\n}\n\n/**\n * Keep track of the number of promises that are rejected along side\n * the number of rejected promises we call _failFn on so we can look\n * for leaked rejections.\n * @constructor\n */\nfunction PromiseStats() {\n  /** @type {number} */\n  this.errorsEmitted = 0\n\n  /** @type {number} */\n  this.errorsHandled = 0\n}\n\nvar stats = new PromiseStats()\n\nPromise.prototype._handleError = function () {\n  if (!this._errorHandled) {\n    stats.errorsHandled++\n    this._errorHandled = true\n  }\n}\n\n/**\n * Specify that the current promise should have a specified context\n * @param  {*} context context\n * @private\n */\nPromise.prototype._useContext = function (context) {\n  this._nextContext = this._currentContext = context\n  this._hasContext = true\n  return this\n}\n\nPromise.prototype.clearContext = function () {\n  this._hasContext = false\n  this._nextContext = undefined\n  return this\n}\n\n/**\n * Set the context for all promise handlers to follow\n *\n * NOTE(dpup): This should be considered deprecated.  It does not do what most\n * people would expect.  The context will be passed as a second argument to all\n * subsequent callbacks.\n *\n * @param {*} context An arbitrary context\n */\nPromise.prototype.setContext = function (context) {\n  this._nextContext = context\n  this._hasContext = true\n  return this\n}\n\n/**\n * Get the context for a promise\n * @return {*} the context set by setContext\n */\nPromise.prototype.getContext = function () {\n  return this._nextContext\n}\n\n/**\n * Resolve this promise with a specified value\n *\n * @param {*=} data\n */\nPromise.prototype.resolve = function (data) {\n  if (this._error || this._hasData) throw new Error(\"Unable to resolve or reject the same promise twice\")\n\n  var i\n  if (data && isPromise(data)) {\n    this._child = data\n    if (this._promises) {\n      for (i = 0; i < this._promises.length; i += 1) {\n        data._chainPromise(this._promises[i])\n      }\n      delete this._promises\n    }\n\n    if (this._onComplete) {\n      for (i = 0; i < this._onComplete.length; i+= 1) {\n        data.fin(this._onComplete[i])\n      }\n      delete this._onComplete\n    }\n  } else if (data && isPromiseLike(data)) {\n    data.then(\n      function(data) { this.resolve(data) }.bind(this),\n      function(err) { this.reject(err) }.bind(this)\n    )\n  } else {\n    this._hasData = true\n    this._data = data\n\n    if (this._onComplete) {\n      for (i = 0; i < this._onComplete.length; i++) {\n        this._onComplete[i]()\n      }\n    }\n\n    if (this._promises) {\n      for (i = 0; i < this._promises.length; i += 1) {\n        this._promises[i]._useContext(this._nextContext)\n        this._promises[i]._withInput(data)\n      }\n      delete this._promises\n    }\n  }\n}\n\n/**\n * Reject this promise with an error\n *\n * @param {!Error} e\n */\nPromise.prototype.reject = function (e) {\n  if (this._error || this._hasData) throw new Error(\"Unable to resolve or reject the same promise twice\")\n\n  var i\n  this._error = e\n  stats.errorsEmitted++\n\n  if (this._ended) {\n    this._handleError()\n    process.nextTick(function onPromiseThrow() {\n      throw e\n    })\n  }\n\n  if (this._onComplete) {\n    for (i = 0; i < this._onComplete.length; i++) {\n      this._onComplete[i]()\n    }\n  }\n\n  if (this._promises) {\n    this._handleError()\n    for (i = 0; i < this._promises.length; i += 1) {\n      this._promises[i]._useContext(this._nextContext)\n      this._promises[i]._withError(e)\n    }\n    delete this._promises\n  }\n}\n\n/**\n * Provide a callback to be called whenever this promise successfully\n * resolves. Allows for an optional second callback to handle the failure\n * case.\n *\n * @param {?function(this:void, T, ?): RESULT|undefined} onSuccess\n * @param {?function(this:void, !Error, ?): RESULT=} onFail\n * @return {!Promise.<RESULT>} returns a new promise with the output of the onSuccess or\n *     onFail handler\n * @template RESULT\n */\nPromise.prototype.then = function (onSuccess, onFail) {\n  var promise = new Promise(onSuccess, onFail)\n  if (this._nextContext) promise._useContext(this._nextContext)\n\n  if (this._child) this._child._chainPromise(promise)\n  else this._chainPromise(promise)\n\n  return promise\n}\n\n/**\n * Provide a callback to be called whenever this promise successfully\n * resolves. The callback will be executed in the context of the provided scope.\n *\n * @param {function(this:SCOPE, ...): RESULT} onSuccess\n * @param {SCOPE} scope Object whose context callback will be executed in.\n * @param {...*} var_args Additional arguments to be passed to the promise callback.\n * @return {!Promise.<RESULT>} returns a new promise with the output of the onSuccess\n * @template SCOPE, RESULT\n */\nPromise.prototype.thenBound = function (onSuccess, scope, var_args) {\n  var promise = new Promise(onSuccess)\n  if (this._nextContext) promise._useContext(this._nextContext)\n\n  promise._scope = scope\n  if (arguments.length > 2) {\n    promise._boundArgs = Array.prototype.slice.call(arguments, 2)\n  }\n\n  // Chaining must happen after setting args and scope since it may fire callback.\n  if (this._child) this._child._chainPromise(promise)\n  else this._chainPromise(promise)\n\n  return promise\n}\n\n/**\n * Provide a callback to be called whenever this promise is rejected\n *\n * @param {function(this:void, !Error, ?)} onFail\n * @return {!Promise.<T>} returns a new promise with the output of the onFail handler\n */\nPromise.prototype.fail = function (onFail) {\n  return this.then(null, onFail)\n}\n\n/**\n * Provide a callback to be called whenever this promise is rejected.\n * The callback will be executed in the context of the provided scope.\n *\n * @param {function(this:SCOPE, ...)} onFail\n * @param {SCOPE} scope Object whose context callback will be executed in.\n * @param {...?} var_args\n * @return {!Promise.<T>} returns a new promise with the output of the onSuccess\n * @template SCOPE\n */\nPromise.prototype.failBound = function (onFail, scope, var_args) {\n  var promise = new Promise(null, onFail)\n  if (this._nextContext) promise._useContext(this._nextContext)\n\n  promise._scope = scope\n  if (arguments.length > 2) {\n    promise._boundArgs = Array.prototype.slice.call(arguments, 2)\n  }\n\n  // Chaining must happen after setting args and scope since it may fire callback.\n  if (this._child) this._child._chainPromise(promise)\n  else this._chainPromise(promise)\n\n  return promise\n}\n\n/**\n * Spread a promises outputs to the functions arguments.\n * @param {?function(this:void, ...): RESULT|undefined} onSuccess\n * @return {!Promise.<RESULT>} returns a new promise with the output of the onSuccess or\n *     onFail handler\n * @template RESULT\n */\nPromise.prototype.spread = function (onSuccess) {\n  return this.then(allInternal)\n  .then(function (array) {\n    return onSuccess.apply(null, array)\n  })\n}\n\n/**\n * Spread a promises outputs to the functions arguments.\n * @param {function(this:SCOPE, ...): RESULT} onSuccess\n * @param {SCOPE} scope Object whose context callback will be executed in.\n * @param {...*} var_args Additional arguments to be passed to the promise callback.\n * @return {!Promise.<RESULT>} returns a new promise with the output of the onSuccess\n * @template SCOPE, RESULT\n */\nPromise.prototype.spreadBound = function (onSuccess, scope, var_args) {\n  var args = Array.prototype.slice.call(arguments, 2)\n  return this.then(allInternal)\n  .then(function (array) {\n    return onSuccess.apply(scope, args.concat(array))\n  })\n}\n\n/**\n * Provide a callback to be called whenever this promise is either resolved\n * or rejected.\n *\n * @param {function()} onComplete\n * @return {!Promise.<T>} returns the current promise\n */\nPromise.prototype.fin = function (onComplete) {\n  if (this._hasData || this._error) {\n    onComplete()\n    return this\n  }\n\n  if (this._child) {\n    this._child.fin(onComplete)\n  } else {\n    if (!this._onComplete) this._onComplete = [onComplete]\n    else this._onComplete.push(onComplete)\n  }\n\n  return this\n}\n\n/**\n * Mark this promise as \"ended\". If the promise is rejected, this will throw an\n * error in whatever scope it happens to be in\n *\n * @return {!Promise.<T>} returns the current promise\n * @deprecated Prefer done(), because it's consistent with Q.\n */\nPromise.prototype.end = function () {\n  this._end()\n  return this\n}\n\n\n/**\n * Mark this promise as \"ended\".\n * @private\n */\nPromise.prototype._end = function () {\n  if (this._error) {\n    this._handleError()\n    throw this._error\n  }\n  this._ended = true\n  return this\n}\n\n/**\n * Close the promise. Any errors after this completes will be thrown to the global handler.\n *\n * @param {?function(this:void, T, ?)=} onSuccess a function to handle successful\n *     resolution of this promise\n * @param {?function(this:void, !Error, ?)=} onFailure a function to handle failed\n *     resolution of this promise\n * @return {void}\n */\nPromise.prototype.done = function (onSuccess, onFailure) {\n  var self = this\n  if (onSuccess || onFailure) {\n    self = self.then(onSuccess, onFailure)\n  }\n  self._end()\n}\n\n/**\n * Return a new promise that behaves the same as the current promise except\n * that it will be rejected if the current promise does not get fulfilled\n * after a certain amount of time.\n *\n * @param {number} timeoutMs The timeout threshold in msec\n * @param {string=} timeoutMsg error message\n * @return {!Promise.<T>} a new promise with timeout\n */\n Promise.prototype.timeout = function (timeoutMs, timeoutMsg) {\n  var deferred = new Promise()\n  var isTimeout = false\n\n  var timeout = setTimeout(function() {\n    deferred.reject(new Error(timeoutMsg || 'Promise timeout after ' + timeoutMs + ' ms.'))\n    isTimeout = true\n  }, timeoutMs)\n\n  this.then(function (data) {\n    if (!isTimeout) {\n      clearTimeout(timeout)\n      deferred.resolve(data)\n    }\n  },\n  function (err) {\n    if (!isTimeout) {\n      clearTimeout(timeout)\n      deferred.reject(err)\n    }\n  })\n\n  return deferred.promise\n}\n\n/**\n * Attempt to resolve this promise with the specified input\n *\n * @param {*} data the input\n */\nPromise.prototype._withInput = function (data) {\n  if (this._successFn) {\n    this._nextTick(this._successFn, [data, this._currentContext])\n  } else {\n    this.resolve(data)\n  }\n\n  // context is no longer needed\n  delete this._currentContext\n}\n\n/**\n * Attempt to reject this promise with the specified error\n *\n * @param {!Error} e\n * @private\n */\nPromise.prototype._withError = function (e) {\n  if (this._failFn) {\n    this._nextTick(this._failFn, [e, this._currentContext])\n  } else {\n    this.reject(e)\n  }\n\n  // context is no longer needed\n  delete this._currentContext\n}\n\n/**\n * Calls a function in the correct scope, and includes bound arguments.\n * @param {Function} fn\n * @param {Array} args\n * @private\n */\nPromise.prototype._nextTick = function (fn, args) {\n  if (this._boundArgs) {\n    args = this._boundArgs.concat(args)\n  }\n  nextTick(nextTickCallback.bind(null, this, fn, this._scope, args))\n}\n\n/**\n * Chain a promise to the current promise\n *\n * @param {!Promise} promise the promise to chain\n * @private\n */\nPromise.prototype._chainPromise = function (promise) {\n  var i\n  if (this._hasContext) promise._useContext(this._nextContext)\n\n  if (this._child) {\n    this._child._chainPromise(promise)\n  } else if (this._hasData) {\n    promise._withInput(this._data)\n  } else if (this._error) {\n    // We can't rely on _withError() because it's called on the chained promises\n    // and we need to use the source's _errorHandled state\n    this._handleError()\n    promise._withError(this._error)\n  } else if (!this._promises) {\n    this._promises = [promise]\n  } else {\n    this._promises.push(promise)\n  }\n}\n\n/**\n * Utility function used for creating a node-style resolver\n * for deferreds\n *\n * @param {!Promise} deferred a promise that looks like a deferred\n * @param {Error=} err an optional error\n * @param {*=} data optional data\n */\nfunction resolver(deferred, err, data) {\n  if (err) deferred.reject(err)\n  else deferred.resolve(data)\n}\n\n/**\n * Creates a node-style resolver for a deferred by wrapping\n * resolver()\n *\n * @return {function(?Error, *)} node-style callback\n */\nPromise.prototype.makeNodeResolver = function () {\n  return resolver.bind(null, this)\n}\n\n/**\n * Return true iff the given object is a promise of this library.\n *\n * Because kew's API is slightly different than other promise libraries,\n * it's important that we have a test for its promise type. If you want\n * to test for a more general A+ promise, you should do a cap test for\n * the features you want.\n *\n * @param {*} obj The object to test\n * @return {boolean} Whether the object is a promise\n */\nfunction isPromise(obj) {\n  return !!obj._isPromise\n}\n\n/**\n * Return true iff the given object is a promise-like object, e.g. appears to\n * implement Promises/A+ specification\n *\n * @param {*} obj The object to test\n * @return {boolean} Whether the object is a promise-like object\n */\nfunction isPromiseLike(obj) {\n  return (typeof obj === 'object' || typeof obj === 'function') &&\n    typeof obj.then === 'function'\n}\n\n/**\n * Static function which creates and resolves a promise immediately\n *\n * @param {T} data data to resolve the promise with\n * @return {!Promise.<T>}\n * @template T\n */\nfunction resolve(data) {\n  var promise = new Promise()\n  promise.resolve(data)\n  return promise\n}\n\n/**\n * Static function which creates and rejects a promise immediately\n *\n * @param {!Error} e error to reject the promise with\n * @return {!Promise}\n */\nfunction reject(e) {\n  var promise = new Promise()\n  promise.reject(e)\n  return promise\n}\n\n/**\n * Replace an element in an array with a new value. Used by .all() to\n * call from .then()\n *\n * @param {!Array} arr\n * @param {number} idx\n * @param {*} val\n * @return {*} the val that's being injected into the array\n */\nfunction replaceEl(arr, idx, val) {\n  arr[idx] = val\n  return val\n}\n\n/**\n * Replace an element in an array as it is resolved with its value.\n * Used by .allSettled().\n *\n * @param {!Array} arr\n * @param {number} idx\n * @param {*} value The value from a resolved promise.\n * @return {*} the data that's being passed in\n */\nfunction replaceElFulfilled(arr, idx, value) {\n  arr[idx] = {\n    state: 'fulfilled',\n    value: value\n  }\n  return value\n}\n\n/**\n * Replace an element in an array as it is rejected with the reason.\n * Used by .allSettled().\n *\n * @param {!Array} arr\n * @param {number} idx\n * @param {*} reason The reason why the original promise is rejected\n * @return {*} the data that's being passed in\n */\nfunction replaceElRejected(arr, idx, reason) {\n  arr[idx] = {\n    state: 'rejected',\n    reason: reason\n  }\n  return reason\n}\n\n/**\n * Takes in an array of promises or literals and returns a promise which returns\n * an array of values when all have resolved. If any fail, the promise fails.\n *\n * @param {!Array.<!Promise>} promises\n * @return {!Promise.<!Array>}\n */\nfunction all(promises) {\n  if (arguments.length != 1 || !Array.isArray(promises)) {\n    promises = Array.prototype.slice.call(arguments, 0)\n  }\n  return allInternal(promises)\n}\n\n/**\n * A version of all() that does not accept var_args\n *\n * @param {!Array.<!Promise>} promises\n * @return {!Promise.<!Array>}\n */\nfunction allInternal(promises) {\n  if (!promises.length) return resolve([])\n\n  var outputs = []\n  var finished = false\n  var promise = new Promise()\n  var counter = promises.length\n\n  for (var i = 0; i < promises.length; i += 1) {\n    if (!promises[i] || !isPromiseLike(promises[i])) {\n      outputs[i] = promises[i]\n      counter -= 1\n    } else {\n      promises[i].then(replaceEl.bind(null, outputs, i))\n      .then(function decrementAllCounter() {\n        counter--\n        if (!finished && counter === 0) {\n          finished = true\n          promise.resolve(outputs)\n        }\n      }, function onAllError(e) {\n        if (!finished) {\n          finished = true\n          promise.reject(e)\n        }\n      })\n    }\n  }\n\n  if (counter === 0 && !finished) {\n    finished = true\n    promise.resolve(outputs)\n  }\n\n  return promise\n}\n\n/**\n * Takes in an array of promises or values and returns a promise that is\n * fulfilled with an array of state objects when all have resolved or\n * rejected. If a promise is resolved, its corresponding state object is\n * {state: 'fulfilled', value: Object}; whereas if a promise is rejected, its\n * corresponding state object is {state: 'rejected', reason: Object}.\n *\n * @param {!Array} promises or values\n * @return {!Promise.<!Array>} Promise fulfilled with state objects for each input\n */\nfunction allSettled(promises) {\n  if (!Array.isArray(promises)) {\n    throw Error('The input to \"allSettled()\" should be an array of Promise or values')\n  }\n  if (!promises.length) return resolve([])\n\n  var outputs = []\n  var promise = new Promise()\n  var counter = promises.length\n\n  for (var i = 0; i < promises.length; i += 1) {\n    if (!promises[i] || !isPromiseLike(promises[i])) {\n      replaceElFulfilled(outputs, i, promises[i])\n      if ((--counter) === 0) promise.resolve(outputs)\n    } else {\n      promises[i]\n        .then(replaceElFulfilled.bind(null, outputs, i), replaceElRejected.bind(null, outputs, i))\n        .then(function () {\n          if ((--counter) === 0) promise.resolve(outputs)\n        })\n    }\n  }\n\n  return promise\n}\n\n/**\n * Takes an array of results and spreads them to the arguments of a function.\n * @param {!Array} array\n * @param {!Function} fn\n */\nfunction spread(array, fn) {\n  resolve(array).spread(fn)\n}\n\n/**\n * Create a new Promise which looks like a deferred\n *\n * @return {!Promise}\n */\nfunction defer() {\n  return new Promise()\n}\n\n/**\n * Return a promise which will wait a specified number of ms to resolve\n *\n * @param {*} delayMsOrVal A delay (in ms) if this takes one argument, or ther\n *     return value if it takes two.\n * @param {number=} opt_delayMs\n * @return {!Promise}\n */\nfunction delay(delayMsOrVal, opt_delayMs) {\n  var returnVal = undefined\n  var delayMs = delayMsOrVal\n  if (typeof opt_delayMs != 'undefined') {\n    delayMs = opt_delayMs\n    returnVal = delayMsOrVal\n  }\n\n  if (typeof delayMs != 'number') {\n    throw new Error('Bad delay value ' + delayMs)\n  }\n\n  var defer = new Promise()\n  setTimeout(function onDelay() {\n    defer.resolve(returnVal)\n  }, delayMs)\n  return defer\n}\n\n/**\n * Returns a promise that has the same result as `this`, but fulfilled\n * after at least ms milliseconds\n * @param {number} ms\n */\nPromise.prototype.delay = function (ms) {\n  return this.then(function (val) {\n    return delay(val, ms)\n  })\n}\n\n/**\n * Return a promise which will evaluate the function fn in a future turn with\n * the provided args\n *\n * @param {function(...)} fn\n * @param {...*} var_args a variable number of arguments\n * @return {!Promise}\n */\nfunction fcall(fn, var_args) {\n  var rootArgs = Array.prototype.slice.call(arguments, 1)\n  var defer = new Promise()\n  nextTick(nextTickCallback.bind(null, defer, fn, undefined, rootArgs))\n  return defer\n}\n\n\n/**\n * Returns a promise that will be invoked with the result of a node style\n * callback. All args to fn should be given except for the final callback arg\n *\n * @param {function(...)} fn\n * @param {...*} var_args a variable number of arguments\n * @return {!Promise}\n */\nfunction nfcall(fn, var_args) {\n  // Insert an undefined argument for scope and let bindPromise() do the work.\n  var args = Array.prototype.slice.call(arguments, 0)\n  args.splice(1, 0, undefined)\n  return ncall.apply(undefined, args)\n}\n\n\n/**\n * Like `nfcall`, but permits passing a `this` context for the call.\n *\n * @param {function(...)} fn\n * @param {Object} scope\n * @param {...*} var_args\n * @return {!Promise}\n */\nfunction ncall(fn, scope, var_args) {\n  return bindPromise.apply(null, arguments)()\n}\n\n\n/**\n * Binds a function to a scope with an optional number of curried arguments. Attaches\n * a node style callback as the last argument and returns a promise\n *\n * @param {function(...)} fn\n * @param {Object} scope\n * @param {...*} var_args a variable number of arguments\n * @return {function(...)}: !Promise}\n */\nfunction bindPromise(fn, scope, var_args) {\n  var rootArgs = Array.prototype.slice.call(arguments, 2)\n  return function onBoundPromise(var_args) {\n    var defer = new Promise()\n    try {\n      fn.apply(scope, rootArgs.concat(Array.prototype.slice.call(arguments, 0), defer.makeNodeResolver()))\n    } catch (e) {\n      defer.reject(e)\n    }\n    return defer\n  }\n}\n\nmodule.exports = {\n  all: all,\n  bindPromise: bindPromise,\n  defer: defer,\n  delay: delay,\n  fcall: fcall,\n  isPromise: isPromise,\n  isPromiseLike: isPromiseLike,\n  ncall: ncall,\n  nfcall: nfcall,\n  resolve: resolve,\n  reject: reject,\n  spread: spread,\n  stats: stats,\n  allSettled: allSettled,\n  Promise: Promise,\n  getNextTickFunction: getNextTickFunction,\n  setNextTickFunction: setNextTickFunction,\n}\n"],"file":"kew.js"}