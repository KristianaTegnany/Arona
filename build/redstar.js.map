{"version":3,"sources":["../node_modules/redstar/redstar.js"],"names":["fs","require","path","minimatch","log","glob","pattern","opts","callback","filesFound","dirsFound","errors","_dirsOnly","length","sep","dirPattern","slice","lastIndexOf","globstar","indexOf","ignoreList","ignore","ignored","Array","ignoreDefaults","push","MAX_DEPTH","depth","firstStarIndex","root","yolo","callbacks","callbacksFinished","_timeout","finishCallback","clearTimeout","setTimeout","files","Object","keys","dirs","err","forEach","e","add","dirpath","readdir","file","filepath","join","stat","stats","i","ignorePattern","shouldIgnore","isDirectory","dir","matches","isFile","hasMagic","module","exports"],"mappings":"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","sourcesContent":["var fs = require( 'fs' )\nvar path = require( 'path' )\nvar minimatch = require( 'minimatch' )\n\nfunction log () {\n  // console.log.apply( this, arguments )\n}\n\nfunction glob ( pattern, opts, callback ) {\n  var filesFound = {}\n  var dirsFound = {}\n  opts = opts || {}\n\n  var errors = []\n  var _dirsOnly = ( pattern[ pattern.length - 1 ] === path.sep )\n\n  var dirPattern = pattern.slice( 0, pattern.lastIndexOf( path.sep ) )\n  if ( dirPattern[ dirPattern.length - 1 ] !== path.sep ) dirPattern += path.sep\n\n  log( 'dirPattern: ' + dirPattern )\n  log( 'dirsOnly: ' + _dirsOnly )\n\n  if ( typeof opts === 'function' ) {\n    callback = opts\n    opts = {}\n  }\n\n  var globstar = false\n\n  if ( pattern.indexOf( '**' ) >= 0 ) globstar = true\n\n  var ignoreList = ( opts.ignore || opts.ignored || [] )\n\n  if ( !( ignoreList instanceof Array ) ) ignoreList = [ ignoreList ]\n\n  if ( !opts.ignoreDefaults ) {\n    // ignore node_modules\n    ignoreList.push( '**/node_modules/**' )\n    ignoreList.push( 'node_modules' )\n\n    // ignore dotfiles\n    ignoreList.push( '**/.*' )\n    ignoreList.push( '.git' )\n  }\n\n  var MAX_DEPTH = ( opts.depth || 7 )\n\n  var firstStarIndex = pattern.indexOf( '*' )\n\n  var root = ( pattern.slice( 0, firstStarIndex ) || '.' )\n\n  log( 'root: ' + root )\n\n  // yolo into the disk\n  yolo( root, 1, MAX_DEPTH )\n\n  var callbacks = 1\n  var callbacksFinished = 0\n\n  var _timeout\n  function finishCallback () {\n    callbacksFinished++\n\n    clearTimeout( _timeout )\n    _timeout = setTimeout( function () {\n      log( callbacks + ' /  ' + callbacksFinished )\n      if ( callbacks === callbacksFinished ) {\n        // we're done!\n        var files = Object.keys( filesFound )\n        var dirs = Object.keys( dirsFound )\n\n        var err = null\n        if ( errors.length > 0 ) {\n          err = errors\n          errors.forEach( function ( e ) {\n            log( e )\n          } )\n        }\n\n        log( 'finished! files found: ' + files.length )\n        callback( err, files, dirs )\n      }\n    }, 1 )\n  }\n\n  function add () {\n    callbacks++\n  }\n\n  function yolo ( dirpath, depth, MAX_DEPTH ) {\n    if ( !MAX_DEPTH ) MAX_DEPTH = 6\n\n    log( 'yoloing ' + depth + ' / ' + MAX_DEPTH )\n\n    add()\n    fs.readdir( dirpath, function ( err, files ) {\n      finishCallback()\n\n      if ( err ) {\n        return errors.push( err )\n      }\n\n      files.forEach( function ( file ) {\n        log( 'path: ' + file )\n        var filepath = path.join( dirpath, file )\n        file = filepath\n\n        add()\n        fs.stat( file, function ( err, stats ) {\n          finishCallback()\n\n          if ( err ) {\n            return errors.push( { path: file, err: err } )\n          }\n\n          for ( var i = 0; i < ignoreList.length; i++ ) {\n            var ignorePattern = ignoreList[ i ]\n            var shouldIgnore = minimatch( file, ignorePattern )\n            if ( shouldIgnore ) return\n          }\n\n          if ( stats.isDirectory() ) {\n            log( 'dir: ' + file )\n\n            var dir = file\n            if ( dir[ dir.length - 1 ] !== path.sep ) dir += path.sep\n\n            var matches = minimatch( dir, dirPattern )\n\n            if ( matches ) {\n              dirsFound[ file ] = file\n              log( 'found dir match: ' + file )\n\n              if ( _dirsOnly ) {\n                filesFound[ file ] = file\n              }\n            }\n\n            // TODO yolo level deeper\n            if ( globstar ) {\n              if ( depth < MAX_DEPTH ) {\n                yolo( file, depth + 1 )\n              } else {\n                log( 'MAX_DEPTH reached: ' + depth + ' / ' + MAX_DEPTH )\n              }\n            }\n          } else if ( stats.isFile() ) {\n            if ( _dirsOnly ) return\n\n            log( 'file: ' + file )\n\n            var matches = minimatch( file, pattern )\n\n            if ( matches ) {\n              filesFound[ file ] = file\n              log( 'found match: ' + file )\n            }\n          }\n        } )\n      } )\n    } )\n  }\n}\n\nglob.hasMagic = function ( pattern ) {\n  return ( pattern.indexOf( '*' ) >= 0 )\n}\n\nmodule.exports = glob\n\n// glob( 'test/tmp/**.css', function ( files ) {\n//   console.log( files )\n// } )\n"],"file":"redstar.js"}