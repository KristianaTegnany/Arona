{"version":3,"sources":["../node_modules/xmldom/sax.js"],"names":["nameStartChar","nameChar","tagNamePattern","S_TAG","S_ATTR","S_ATTR_SPACE","S_EQ","S_ATTR_NOQUOT_VALUE","S_ATTR_END","S_TAG_SPACE","S_TAG_CLOSE","XMLReader","parse","domBuilder","_copy","defaultNSMap","code","surrogate1","surrogate2","String","k","a","entityMap","fixedFromCharCode","parseInt","errorHandler","end","xt","source","locator","position","start","p","m","linePattern","lineStart","lineEnd","parseStack","currentNSMap","defaultNSMapCopy","closeMap","tagStart","doc","text","appendText","tagName","config","localNSMap","endMatch","endIgnoreCaseMach","parseInstruction","parseDCC","el","parseElementStartPart","len","fixSelfClosed","locator2","copyLocator","i","appendElement","parseHtmlSpecialContent","Math","t","f","s","c","attrName","value","qName","nsp","prefix","localName","nsPrefix","ns","elEndStart","elStartEnd","pos","target","next","matchs","split","name","pubid","sysid","lastMatch","match","ElementAttributes","setTagName","add","offset","length","getLocalName","getLocator","getQName","getURI","getValue","thiz","_set_proto_","buf","reg","exports"],"mappings":"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","sourcesContent":["//[4]   \tNameStartChar\t   ::=   \t\":\" | [A-Z] | \"_\" | [a-z] | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x2FF] | [#x370-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]\r\n//[4a]   \tNameChar\t   ::=   \tNameStartChar | \"-\" | \".\" | [0-9] | #xB7 | [#x0300-#x036F] | [#x203F-#x2040]\r\n//[5]   \tName\t   ::=   \tNameStartChar (NameChar)*\r\nvar nameStartChar = /[A-Z_a-z\\xC0-\\xD6\\xD8-\\xF6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]///\\u10000-\\uEFFFF\r\nvar nameChar = new RegExp(\"[\\\\-\\\\.0-9\"+nameStartChar.source.slice(1,-1)+\"\\\\u00B7\\\\u0300-\\\\u036F\\\\u203F-\\\\u2040]\");\r\nvar tagNamePattern = new RegExp('^'+nameStartChar.source+nameChar.source+'*(?:\\:'+nameStartChar.source+nameChar.source+'*)?$');\r\n//var tagNamePattern = /^[a-zA-Z_][\\w\\-\\.]*(?:\\:[a-zA-Z_][\\w\\-\\.]*)?$/\r\n//var handlers = 'resolveEntity,getExternalSubset,characters,endDocument,endElement,endPrefixMapping,ignorableWhitespace,processingInstruction,setDocumentLocator,skippedEntity,startDocument,startElement,startPrefixMapping,notationDecl,unparsedEntityDecl,error,fatalError,warning,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,comment,endCDATA,endDTD,endEntity,startCDATA,startDTD,startEntity'.split(',')\r\n\r\n//S_TAG,\tS_ATTR,\tS_EQ,\tS_ATTR_NOQUOT_VALUE\r\n//S_ATTR_SPACE,\tS_ATTR_END,\tS_TAG_SPACE, S_TAG_CLOSE\r\nvar S_TAG = 0;//tag name offerring\r\nvar S_ATTR = 1;//attr name offerring \r\nvar S_ATTR_SPACE=2;//attr name end and space offer\r\nvar S_EQ = 3;//=space?\r\nvar S_ATTR_NOQUOT_VALUE = 4;//attr value(no quot value only)\r\nvar S_ATTR_END = 5;//attr value end and no space(quot end)\r\nvar S_TAG_SPACE = 6;//(attr value end || tag end ) && (space offer)\r\nvar S_TAG_CLOSE = 7;//closed el<el />\r\n\r\nfunction XMLReader(){\r\n\t\r\n}\r\n\r\nXMLReader.prototype = {\r\n\tparse:function(source,defaultNSMap,entityMap){\r\n\t\tvar domBuilder = this.domBuilder;\r\n\t\tdomBuilder.startDocument();\r\n\t\t_copy(defaultNSMap ,defaultNSMap = {})\r\n\t\tparse(source,defaultNSMap,entityMap,\r\n\t\t\t\tdomBuilder,this.errorHandler);\r\n\t\tdomBuilder.endDocument();\r\n\t}\r\n}\r\nfunction parse(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){\r\n\tfunction fixedFromCharCode(code) {\r\n\t\t// String.prototype.fromCharCode does not supports\r\n\t\t// > 2 bytes unicode chars directly\r\n\t\tif (code > 0xffff) {\r\n\t\t\tcode -= 0x10000;\r\n\t\t\tvar surrogate1 = 0xd800 + (code >> 10)\r\n\t\t\t\t, surrogate2 = 0xdc00 + (code & 0x3ff);\r\n\r\n\t\t\treturn String.fromCharCode(surrogate1, surrogate2);\r\n\t\t} else {\r\n\t\t\treturn String.fromCharCode(code);\r\n\t\t}\r\n\t}\r\n\tfunction entityReplacer(a){\r\n\t\tvar k = a.slice(1,-1);\r\n\t\tif(k in entityMap){\r\n\t\t\treturn entityMap[k]; \r\n\t\t}else if(k.charAt(0) === '#'){\r\n\t\t\treturn fixedFromCharCode(parseInt(k.substr(1).replace('x','0x')))\r\n\t\t}else{\r\n\t\t\terrorHandler.error('entity not found:'+a);\r\n\t\t\treturn a;\r\n\t\t}\r\n\t}\r\n\tfunction appendText(end){//has some bugs\r\n\t\tif(end>start){\r\n\t\t\tvar xt = source.substring(start,end).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\tlocator&&position(start);\r\n\t\t\tdomBuilder.characters(xt,0,end-start);\r\n\t\t\tstart = end\r\n\t\t}\r\n\t}\r\n\tfunction position(p,m){\r\n\t\twhile(p>=lineEnd && (m = linePattern.exec(source))){\r\n\t\t\tlineStart = m.index;\r\n\t\t\tlineEnd = lineStart + m[0].length;\r\n\t\t\tlocator.lineNumber++;\r\n\t\t\t//console.log('line++:',locator,startPos,endPos)\r\n\t\t}\r\n\t\tlocator.columnNumber = p-lineStart+1;\r\n\t}\r\n\tvar lineStart = 0;\r\n\tvar lineEnd = 0;\r\n\tvar linePattern = /.*(?:\\r\\n?|\\n)|.*$/g\r\n\tvar locator = domBuilder.locator;\r\n\t\r\n\tvar parseStack = [{currentNSMap:defaultNSMapCopy}]\r\n\tvar closeMap = {};\r\n\tvar start = 0;\r\n\twhile(true){\r\n\t\ttry{\r\n\t\t\tvar tagStart = source.indexOf('<',start);\r\n\t\t\tif(tagStart<0){\r\n\t\t\t\tif(!source.substr(start).match(/^\\s*$/)){\r\n\t\t\t\t\tvar doc = domBuilder.doc;\r\n\t    \t\t\tvar text = doc.createTextNode(source.substr(start));\r\n\t    \t\t\tdoc.appendChild(text);\r\n\t    \t\t\tdomBuilder.currentElement = text;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(tagStart>start){\r\n\t\t\t\tappendText(tagStart);\r\n\t\t\t}\r\n\t\t\tswitch(source.charAt(tagStart+1)){\r\n\t\t\tcase '/':\r\n\t\t\t\tvar end = source.indexOf('>',tagStart+3);\r\n\t\t\t\tvar tagName = source.substring(tagStart+2,end);\r\n\t\t\t\tvar config = parseStack.pop();\r\n\t\t\t\tif(end<0){\r\n\t\t\t\t\t\r\n\t        \t\ttagName = source.substring(tagStart+2).replace(/[\\s<].*/,'');\r\n\t        \t\t//console.error('#@@@@@@'+tagName)\r\n\t        \t\terrorHandler.error(\"end tag name: \"+tagName+' is not complete:'+config.tagName);\r\n\t        \t\tend = tagStart+1+tagName.length;\r\n\t        \t}else if(tagName.match(/\\s</)){\r\n\t        \t\ttagName = tagName.replace(/[\\s<].*/,'');\r\n\t        \t\terrorHandler.error(\"end tag name: \"+tagName+' maybe not complete');\r\n\t        \t\tend = tagStart+1+tagName.length;\r\n\t\t\t\t}\r\n\t\t\t\t//console.error(parseStack.length,parseStack)\r\n\t\t\t\t//console.error(config);\r\n\t\t\t\tvar localNSMap = config.localNSMap;\r\n\t\t\t\tvar endMatch = config.tagName == tagName;\r\n\t\t\t\tvar endIgnoreCaseMach = endMatch || config.tagName&&config.tagName.toLowerCase() == tagName.toLowerCase()\r\n\t\t        if(endIgnoreCaseMach){\r\n\t\t        \tdomBuilder.endElement(config.uri,config.localName,tagName);\r\n\t\t\t\t\tif(localNSMap){\r\n\t\t\t\t\t\tfor(var prefix in localNSMap){\r\n\t\t\t\t\t\t\tdomBuilder.endPrefixMapping(prefix) ;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!endMatch){\r\n\t\t            \terrorHandler.fatalError(\"end tag name: \"+tagName+' is not match the current start tagName:'+config.tagName );\r\n\t\t\t\t\t}\r\n\t\t        }else{\r\n\t\t        \tparseStack.push(config)\r\n\t\t        }\r\n\t\t\t\t\r\n\t\t\t\tend++;\r\n\t\t\t\tbreak;\r\n\t\t\t\t// end elment\r\n\t\t\tcase '?':// <?...?>\r\n\t\t\t\tlocator&&position(tagStart);\r\n\t\t\t\tend = parseInstruction(source,tagStart,domBuilder);\r\n\t\t\t\tbreak;\r\n\t\t\tcase '!':// <!doctype,<![CDATA,<!--\r\n\t\t\t\tlocator&&position(tagStart);\r\n\t\t\t\tend = parseDCC(source,tagStart,domBuilder,errorHandler);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tlocator&&position(tagStart);\r\n\t\t\t\tvar el = new ElementAttributes();\r\n\t\t\t\tvar currentNSMap = parseStack[parseStack.length-1].currentNSMap;\r\n\t\t\t\t//elStartEnd\r\n\t\t\t\tvar end = parseElementStartPart(source,tagStart,el,currentNSMap,entityReplacer,errorHandler);\r\n\t\t\t\tvar len = el.length;\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif(!el.closed && fixSelfClosed(source,end,el.tagName,closeMap)){\r\n\t\t\t\t\tel.closed = true;\r\n\t\t\t\t\tif(!entityMap.nbsp){\r\n\t\t\t\t\t\terrorHandler.warning('unclosed xml attribute');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(locator && len){\r\n\t\t\t\t\tvar locator2 = copyLocator(locator,{});\r\n\t\t\t\t\t//try{//attribute position fixed\r\n\t\t\t\t\tfor(var i = 0;i<len;i++){\r\n\t\t\t\t\t\tvar a = el[i];\r\n\t\t\t\t\t\tposition(a.offset);\r\n\t\t\t\t\t\ta.locator = copyLocator(locator,{});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//}catch(e){console.error('@@@@@'+e)}\r\n\t\t\t\t\tdomBuilder.locator = locator2\r\n\t\t\t\t\tif(appendElement(el,domBuilder,currentNSMap)){\r\n\t\t\t\t\t\tparseStack.push(el)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdomBuilder.locator = locator;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(appendElement(el,domBuilder,currentNSMap)){\r\n\t\t\t\t\t\tparseStack.push(el)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif(el.uri === 'http://www.w3.org/1999/xhtml' && !el.closed){\r\n\t\t\t\t\tend = parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)\r\n\t\t\t\t}else{\r\n\t\t\t\t\tend++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}catch(e){\r\n\t\t\terrorHandler.error('element parse error: '+e)\r\n\t\t\t//errorHandler.error('element parse error: '+e);\r\n\t\t\tend = -1;\r\n\t\t\t//throw e;\r\n\t\t}\r\n\t\tif(end>start){\r\n\t\t\tstart = end;\r\n\t\t}else{\r\n\t\t\t//TODO: 这里有可能sax回退，有位置错误风险\r\n\t\t\tappendText(Math.max(tagStart,start)+1);\r\n\t\t}\r\n\t}\r\n}\r\nfunction copyLocator(f,t){\r\n\tt.lineNumber = f.lineNumber;\r\n\tt.columnNumber = f.columnNumber;\r\n\treturn t;\r\n}\r\n\r\n/**\r\n * @see #appendElement(source,elStartEnd,el,selfClosed,entityReplacer,domBuilder,parseStack);\r\n * @return end of the elementStartPart(end of elementEndPart for selfClosed el)\r\n */\r\nfunction parseElementStartPart(source,start,el,currentNSMap,entityReplacer,errorHandler){\r\n\tvar attrName;\r\n\tvar value;\r\n\tvar p = ++start;\r\n\tvar s = S_TAG;//status\r\n\twhile(true){\r\n\t\tvar c = source.charAt(p);\r\n\t\tswitch(c){\r\n\t\tcase '=':\r\n\t\t\tif(s === S_ATTR){//attrName\r\n\t\t\t\tattrName = source.slice(start,p);\r\n\t\t\t\ts = S_EQ;\r\n\t\t\t}else if(s === S_ATTR_SPACE){\r\n\t\t\t\ts = S_EQ;\r\n\t\t\t}else{\r\n\t\t\t\t//fatalError: equal must after attrName or space after attrName\r\n\t\t\t\tthrow new Error('attribute equal must after attrName');\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase '\\'':\r\n\t\tcase '\"':\r\n\t\t\tif(s === S_EQ || s === S_ATTR //|| s == S_ATTR_SPACE\r\n\t\t\t\t){//equal\r\n\t\t\t\tif(s === S_ATTR){\r\n\t\t\t\t\terrorHandler.warning('attribute value must after \"=\"')\r\n\t\t\t\t\tattrName = source.slice(start,p)\r\n\t\t\t\t}\r\n\t\t\t\tstart = p+1;\r\n\t\t\t\tp = source.indexOf(c,start)\r\n\t\t\t\tif(p>0){\r\n\t\t\t\t\tvalue = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\t\tel.add(attrName,value,start-1);\r\n\t\t\t\t\ts = S_ATTR_END;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t//fatalError: no end quot match\r\n\t\t\t\t\tthrow new Error('attribute value no end \\''+c+'\\' match');\r\n\t\t\t\t}\r\n\t\t\t}else if(s == S_ATTR_NOQUOT_VALUE){\r\n\t\t\t\tvalue = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\t//console.log(attrName,value,start,p)\r\n\t\t\t\tel.add(attrName,value,start);\r\n\t\t\t\t//console.dir(el)\r\n\t\t\t\terrorHandler.warning('attribute \"'+attrName+'\" missed start quot('+c+')!!');\r\n\t\t\t\tstart = p+1;\r\n\t\t\t\ts = S_ATTR_END\r\n\t\t\t}else{\r\n\t\t\t\t//fatalError: no equal before\r\n\t\t\t\tthrow new Error('attribute value must after \"=\"');\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase '/':\r\n\t\t\tswitch(s){\r\n\t\t\tcase S_TAG:\r\n\t\t\t\tel.setTagName(source.slice(start,p));\r\n\t\t\tcase S_ATTR_END:\r\n\t\t\tcase S_TAG_SPACE:\r\n\t\t\tcase S_TAG_CLOSE:\r\n\t\t\t\ts =S_TAG_CLOSE;\r\n\t\t\t\tel.closed = true;\r\n\t\t\tcase S_ATTR_NOQUOT_VALUE:\r\n\t\t\tcase S_ATTR:\r\n\t\t\tcase S_ATTR_SPACE:\r\n\t\t\t\tbreak;\r\n\t\t\t//case S_EQ:\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"attribute invalid close char('/')\")\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase ''://end document\r\n\t\t\t//throw new Error('unexpected end of input')\r\n\t\t\terrorHandler.error('unexpected end of input');\r\n\t\t\tif(s == S_TAG){\r\n\t\t\t\tel.setTagName(source.slice(start,p));\r\n\t\t\t}\r\n\t\t\treturn p;\r\n\t\tcase '>':\r\n\t\t\tswitch(s){\r\n\t\t\tcase S_TAG:\r\n\t\t\t\tel.setTagName(source.slice(start,p));\r\n\t\t\tcase S_ATTR_END:\r\n\t\t\tcase S_TAG_SPACE:\r\n\t\t\tcase S_TAG_CLOSE:\r\n\t\t\t\tbreak;//normal\r\n\t\t\tcase S_ATTR_NOQUOT_VALUE://Compatible state\r\n\t\t\tcase S_ATTR:\r\n\t\t\t\tvalue = source.slice(start,p);\r\n\t\t\t\tif(value.slice(-1) === '/'){\r\n\t\t\t\t\tel.closed  = true;\r\n\t\t\t\t\tvalue = value.slice(0,-1)\r\n\t\t\t\t}\r\n\t\t\tcase S_ATTR_SPACE:\r\n\t\t\t\tif(s === S_ATTR_SPACE){\r\n\t\t\t\t\tvalue = attrName;\r\n\t\t\t\t}\r\n\t\t\t\tif(s == S_ATTR_NOQUOT_VALUE){\r\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed quot(\")!!');\r\n\t\t\t\t\tel.add(attrName,value.replace(/&#?\\w+;/g,entityReplacer),start)\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(currentNSMap[''] !== 'http://www.w3.org/1999/xhtml' || !value.match(/^(?:disabled|checked|selected)$/i)){\r\n\t\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed value!! \"'+value+'\" instead!!')\r\n\t\t\t\t\t}\r\n\t\t\t\t\tel.add(value,value,start)\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase S_EQ:\r\n\t\t\t\tthrow new Error('attribute value missed!!');\r\n\t\t\t}\r\n//\t\t\tconsole.log(tagName,tagNamePattern,tagNamePattern.test(tagName))\r\n\t\t\treturn p;\r\n\t\t/*xml space '\\x20' | #x9 | #xD | #xA; */\r\n\t\tcase '\\u0080':\r\n\t\t\tc = ' ';\r\n\t\tdefault:\r\n\t\t\tif(c<= ' '){//space\r\n\t\t\t\tswitch(s){\r\n\t\t\t\tcase S_TAG:\r\n\t\t\t\t\tel.setTagName(source.slice(start,p));//tagName\r\n\t\t\t\t\ts = S_TAG_SPACE;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_ATTR:\r\n\t\t\t\t\tattrName = source.slice(start,p)\r\n\t\t\t\t\ts = S_ATTR_SPACE;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_ATTR_NOQUOT_VALUE:\r\n\t\t\t\t\tvar value = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed quot(\")!!');\r\n\t\t\t\t\tel.add(attrName,value,start)\r\n\t\t\t\tcase S_ATTR_END:\r\n\t\t\t\t\ts = S_TAG_SPACE;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//case S_TAG_SPACE:\r\n\t\t\t\t//case S_EQ:\r\n\t\t\t\t//case S_ATTR_SPACE:\r\n\t\t\t\t//\tvoid();break;\r\n\t\t\t\t//case S_TAG_CLOSE:\r\n\t\t\t\t\t//ignore warning\r\n\t\t\t\t}\r\n\t\t\t}else{//not space\r\n//S_TAG,\tS_ATTR,\tS_EQ,\tS_ATTR_NOQUOT_VALUE\r\n//S_ATTR_SPACE,\tS_ATTR_END,\tS_TAG_SPACE, S_TAG_CLOSE\r\n\t\t\t\tswitch(s){\r\n\t\t\t\t//case S_TAG:void();break;\r\n\t\t\t\t//case S_ATTR:void();break;\r\n\t\t\t\t//case S_ATTR_NOQUOT_VALUE:void();break;\r\n\t\t\t\tcase S_ATTR_SPACE:\r\n\t\t\t\t\tvar tagName =  el.tagName;\r\n\t\t\t\t\tif(currentNSMap[''] !== 'http://www.w3.org/1999/xhtml' || !attrName.match(/^(?:disabled|checked|selected)$/i)){\r\n\t\t\t\t\t\terrorHandler.warning('attribute \"'+attrName+'\" missed value!! \"'+attrName+'\" instead2!!')\r\n\t\t\t\t\t}\r\n\t\t\t\t\tel.add(attrName,attrName,start);\r\n\t\t\t\t\tstart = p;\r\n\t\t\t\t\ts = S_ATTR;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_ATTR_END:\r\n\t\t\t\t\terrorHandler.warning('attribute space is required\"'+attrName+'\"!!')\r\n\t\t\t\tcase S_TAG_SPACE:\r\n\t\t\t\t\ts = S_ATTR;\r\n\t\t\t\t\tstart = p;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_EQ:\r\n\t\t\t\t\ts = S_ATTR_NOQUOT_VALUE;\r\n\t\t\t\t\tstart = p;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_TAG_CLOSE:\r\n\t\t\t\t\tthrow new Error(\"elements closed character '/' and '>' must be connected to\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}//end outer switch\r\n\t\t//console.log('p++',p)\r\n\t\tp++;\r\n\t}\r\n}\r\n/**\r\n * @return true if has new namespace define\r\n */\r\nfunction appendElement(el,domBuilder,currentNSMap){\r\n\tvar tagName = el.tagName;\r\n\tvar localNSMap = null;\r\n\t//var currentNSMap = parseStack[parseStack.length-1].currentNSMap;\r\n\tvar i = el.length;\r\n\twhile(i--){\r\n\t\tvar a = el[i];\r\n\t\tvar qName = a.qName;\r\n\t\tvar value = a.value;\r\n\t\tvar nsp = qName.indexOf(':');\r\n\t\tif(nsp>0){\r\n\t\t\tvar prefix = a.prefix = qName.slice(0,nsp);\r\n\t\t\tvar localName = qName.slice(nsp+1);\r\n\t\t\tvar nsPrefix = prefix === 'xmlns' && localName\r\n\t\t}else{\r\n\t\t\tlocalName = qName;\r\n\t\t\tprefix = null\r\n\t\t\tnsPrefix = qName === 'xmlns' && ''\r\n\t\t}\r\n\t\t//can not set prefix,because prefix !== ''\r\n\t\ta.localName = localName ;\r\n\t\t//prefix == null for no ns prefix attribute \r\n\t\tif(nsPrefix !== false){//hack!!\r\n\t\t\tif(localNSMap == null){\r\n\t\t\t\tlocalNSMap = {}\r\n\t\t\t\t//console.log(currentNSMap,0)\r\n\t\t\t\t_copy(currentNSMap,currentNSMap={})\r\n\t\t\t\t//console.log(currentNSMap,1)\r\n\t\t\t}\r\n\t\t\tcurrentNSMap[nsPrefix] = localNSMap[nsPrefix] = value;\r\n\t\t\ta.uri = 'http://www.w3.org/2000/xmlns/'\r\n\t\t\tdomBuilder.startPrefixMapping(nsPrefix, value) \r\n\t\t}\r\n\t}\r\n\tvar i = el.length;\r\n\twhile(i--){\r\n\t\ta = el[i];\r\n\t\tvar prefix = a.prefix;\r\n\t\tif(prefix){//no prefix attribute has no namespace\r\n\t\t\tif(prefix === 'xml'){\r\n\t\t\t\ta.uri = 'http://www.w3.org/XML/1998/namespace';\r\n\t\t\t}if(prefix !== 'xmlns'){\r\n\t\t\t\ta.uri = currentNSMap[prefix || '']\r\n\t\t\t\t\r\n\t\t\t\t//{console.log('###'+a.qName,domBuilder.locator.systemId+'',currentNSMap,a.uri)}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tvar nsp = tagName.indexOf(':');\r\n\tif(nsp>0){\r\n\t\tprefix = el.prefix = tagName.slice(0,nsp);\r\n\t\tlocalName = el.localName = tagName.slice(nsp+1);\r\n\t}else{\r\n\t\tprefix = null;//important!!\r\n\t\tlocalName = el.localName = tagName;\r\n\t}\r\n\t//no prefix element has default namespace\r\n\tvar ns = el.uri = currentNSMap[prefix || ''];\r\n\tdomBuilder.startElement(ns,localName,tagName,el);\r\n\t//endPrefixMapping and startPrefixMapping have not any help for dom builder\r\n\t//localNSMap = null\r\n\tif(el.closed){\r\n\t\tdomBuilder.endElement(ns,localName,tagName);\r\n\t\tif(localNSMap){\r\n\t\t\tfor(prefix in localNSMap){\r\n\t\t\t\tdomBuilder.endPrefixMapping(prefix) \r\n\t\t\t}\r\n\t\t}\r\n\t}else{\r\n\t\tel.currentNSMap = currentNSMap;\r\n\t\tel.localNSMap = localNSMap;\r\n\t\t//parseStack.push(el);\r\n\t\treturn true;\r\n\t}\r\n}\r\nfunction parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){\r\n\tif(/^(?:script|textarea)$/i.test(tagName)){\r\n\t\tvar elEndStart =  source.indexOf('</'+tagName+'>',elStartEnd);\r\n\t\tvar text = source.substring(elStartEnd+1,elEndStart);\r\n\t\tif(/[&<]/.test(text)){\r\n\t\t\tif(/^script$/i.test(tagName)){\r\n\t\t\t\t//if(!/\\]\\]>/.test(text)){\r\n\t\t\t\t\t//lexHandler.startCDATA();\r\n\t\t\t\t\tdomBuilder.characters(text,0,text.length);\r\n\t\t\t\t\t//lexHandler.endCDATA();\r\n\t\t\t\t\treturn elEndStart;\r\n\t\t\t\t//}\r\n\t\t\t}//}else{//text area\r\n\t\t\t\ttext = text.replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\tdomBuilder.characters(text,0,text.length);\r\n\t\t\t\treturn elEndStart;\r\n\t\t\t//}\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\treturn elStartEnd+1;\r\n}\r\nfunction fixSelfClosed(source,elStartEnd,tagName,closeMap){\r\n\t//if(tagName in closeMap){\r\n\tvar pos = closeMap[tagName];\r\n\tif(pos == null){\r\n\t\t//console.log(tagName)\r\n\t\tpos =  source.lastIndexOf('</'+tagName+'>')\r\n\t\tif(pos<elStartEnd){//忘记闭合\r\n\t\t\tpos = source.lastIndexOf('</'+tagName)\r\n\t\t}\r\n\t\tcloseMap[tagName] =pos\r\n\t}\r\n\treturn pos<elStartEnd;\r\n\t//} \r\n}\r\nfunction _copy(source,target){\r\n\tfor(var n in source){target[n] = source[n]}\r\n}\r\nfunction parseDCC(source,start,domBuilder,errorHandler){//sure start with '<!'\r\n\tvar next= source.charAt(start+2)\r\n\tswitch(next){\r\n\tcase '-':\r\n\t\tif(source.charAt(start + 3) === '-'){\r\n\t\t\tvar end = source.indexOf('-->',start+4);\r\n\t\t\t//append comment source.substring(4,end)//<!--\r\n\t\t\tif(end>start){\r\n\t\t\t\tdomBuilder.comment(source,start+4,end-start-4);\r\n\t\t\t\treturn end+3;\r\n\t\t\t}else{\r\n\t\t\t\terrorHandler.error(\"Unclosed comment\");\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\t//error\r\n\t\t\treturn -1;\r\n\t\t}\r\n\tdefault:\r\n\t\tif(source.substr(start+3,6) == 'CDATA['){\r\n\t\t\tvar end = source.indexOf(']]>',start+9);\r\n\t\t\tdomBuilder.startCDATA();\r\n\t\t\tdomBuilder.characters(source,start+9,end-start-9);\r\n\t\t\tdomBuilder.endCDATA() \r\n\t\t\treturn end+3;\r\n\t\t}\r\n\t\t//<!DOCTYPE\r\n\t\t//startDTD(java.lang.String name, java.lang.String publicId, java.lang.String systemId) \r\n\t\tvar matchs = split(source,start);\r\n\t\tvar len = matchs.length;\r\n\t\tif(len>1 && /!doctype/i.test(matchs[0][0])){\r\n\t\t\tvar name = matchs[1][0];\r\n\t\t\tvar pubid = len>3 && /^public$/i.test(matchs[2][0]) && matchs[3][0]\r\n\t\t\tvar sysid = len>4 && matchs[4][0];\r\n\t\t\tvar lastMatch = matchs[len-1]\r\n\t\t\tdomBuilder.startDTD(name,pubid && pubid.replace(/^(['\"])(.*?)\\1$/,'$2'),\r\n\t\t\t\t\tsysid && sysid.replace(/^(['\"])(.*?)\\1$/,'$2'));\r\n\t\t\tdomBuilder.endDTD();\r\n\t\t\t\r\n\t\t\treturn lastMatch.index+lastMatch[0].length\r\n\t\t}\r\n\t}\r\n\treturn -1;\r\n}\r\n\r\n\r\n\r\nfunction parseInstruction(source,start,domBuilder){\r\n\tvar end = source.indexOf('?>',start);\r\n\tif(end){\r\n\t\tvar match = source.substring(start,end).match(/^<\\?(\\S*)\\s*([\\s\\S]*?)\\s*$/);\r\n\t\tif(match){\r\n\t\t\tvar len = match[0].length;\r\n\t\t\tdomBuilder.processingInstruction(match[1], match[2]) ;\r\n\t\t\treturn end+2;\r\n\t\t}else{//error\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\treturn -1;\r\n}\r\n\r\n/**\r\n * @param source\r\n */\r\nfunction ElementAttributes(source){\r\n\t\r\n}\r\nElementAttributes.prototype = {\r\n\tsetTagName:function(tagName){\r\n\t\tif(!tagNamePattern.test(tagName)){\r\n\t\t\tthrow new Error('invalid tagName:'+tagName)\r\n\t\t}\r\n\t\tthis.tagName = tagName\r\n\t},\r\n\tadd:function(qName,value,offset){\r\n\t\tif(!tagNamePattern.test(qName)){\r\n\t\t\tthrow new Error('invalid attribute:'+qName)\r\n\t\t}\r\n\t\tthis[this.length++] = {qName:qName,value:value,offset:offset}\r\n\t},\r\n\tlength:0,\r\n\tgetLocalName:function(i){return this[i].localName},\r\n\tgetLocator:function(i){return this[i].locator},\r\n\tgetQName:function(i){return this[i].qName},\r\n\tgetURI:function(i){return this[i].uri},\r\n\tgetValue:function(i){return this[i].value}\r\n//\t,getIndex:function(uri, localName)){\r\n//\t\tif(localName){\r\n//\t\t\t\r\n//\t\t}else{\r\n//\t\t\tvar qName = uri\r\n//\t\t}\r\n//\t},\r\n//\tgetValue:function(){return this.getValue(this.getIndex.apply(this,arguments))},\r\n//\tgetType:function(uri,localName){}\r\n//\tgetType:function(i){},\r\n}\r\n\r\n\r\n\r\n\r\nfunction _set_proto_(thiz,parent){\r\n\tthiz.__proto__ = parent;\r\n\treturn thiz;\r\n}\r\nif(!(_set_proto_({},_set_proto_.prototype) instanceof _set_proto_)){\r\n\t_set_proto_ = function(thiz,parent){\r\n\t\tfunction p(){};\r\n\t\tp.prototype = parent;\r\n\t\tp = new p();\r\n\t\tfor(parent in thiz){\r\n\t\t\tp[parent] = thiz[parent];\r\n\t\t}\r\n\t\treturn p;\r\n\t}\r\n}\r\n\r\nfunction split(source,start){\r\n\tvar match;\r\n\tvar buf = [];\r\n\tvar reg = /'[^']+'|\"[^\"]+\"|[^\\s<>\\/=]+=?|(\\/?\\s*>|<)/g;\r\n\treg.lastIndex = start;\r\n\treg.exec(source);//skip <\r\n\twhile(match = reg.exec(source)){\r\n\t\tbuf.push(match);\r\n\t\tif(match[1])return buf;\r\n\t}\r\n}\r\n\r\nexports.XMLReader = XMLReader;\r\n\r\n"],"file":"sax.js"}