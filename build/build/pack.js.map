{"version":3,"sources":["../node_modules/tar-stream/pack.js"],"names":["util","require","eos","headers","Readable","Writable","PassThrough","END_OF_TAR","noop","overflow","size","self","Sink","data","cb","Void","Pack","callback","buffer","header","Buffer","process","sink","buf","paxHeader","name","linkname","newHeader","mode","uid","gid","mtime","type","uname","gname","devmajor","devminor","drain","module"],"mappings":";;AAAA,IAAIA,IAAI,GAAGC,OAAO,CAAlB,MAAkB,CAAlB;;AACA,IAAIC,GAAG,GAAGD,OAAO,CAAjB,eAAiB,CAAjB;;AACA,IAAIE,OAAO,GAAGF,OAAO,CAArB,WAAqB,CAArB;;AAEA,IAAIG,QAAQ,GAAGH,OAAO,CAAPA,iBAAO,CAAPA,CAAf,QAAA;;AACA,IAAII,QAAQ,GAAGJ,OAAO,CAAPA,iBAAO,CAAPA,CAAf,QAAA;;AACA,IAAIK,WAAW,GAAGL,OAAO,CAAPA,iBAAO,CAAPA,CAAlB,WAAA;;AAEA,IAAIM,UAAU,GAAG,IAAA,MAAA,CAAjB,IAAiB,CAAjB;AACAA,UAAU,CAAVA,IAAAA,CAAAA,CAAAA;;AAEA,IAAIC,IAAI,GAAG,SAAPA,IAAO,GAAW,CAAtB,CAAA;;AAEA,IAAIC,QAAQ,GAAG,SAAXA,QAAW,CAAA,IAAA,EAAA,IAAA,EAAqB;AAClCC,EAAAA,IAAI,IAAJA,GAAAA;AACA,MAAA,IAAA,EAAUC,IAAI,CAAJA,IAAAA,CAAUJ,UAAU,CAAVA,KAAAA,CAAAA,CAAAA,EAAoB,MAA9BI,IAAUJ,CAAVI;AAFZ,CAAA;;AAKA,IAAIC,IAAI,GAAG,SAAPA,IAAO,CAAA,EAAA,EAAa;AACtBP,EAAAA,QAAQ,CAARA,IAAAA,CAAAA,IAAAA;AACA,OAAA,OAAA,GAAA,CAAA;AACA,OAAA,GAAA,GAAA,EAAA;AACA,OAAA,UAAA,GAAA,KAAA;AAJF,CAAA;;AAOAL,IAAI,CAAJA,QAAAA,CAAAA,IAAAA,EAAAA,QAAAA;;AAEAY,IAAI,CAAJA,SAAAA,CAAAA,MAAAA,GAAwB,UAAA,IAAA,EAAA,GAAA,EAAA,EAAA,EAAwB;AAC9C,OAAA,OAAA,IAAgBC,IAAI,CAApB,MAAA;AACA,MAAI,KAAA,GAAA,CAAA,IAAA,CAAJ,IAAI,CAAJ,EAAyB,OAAOC,EAAP,EAAA;AACzB,OAAA,GAAA,CAAA,MAAA,GAAA,EAAA;AAHFF,CAAAA;;AAMAA,IAAI,CAAJA,SAAAA,CAAAA,OAAAA,GAAyB,YAAW;AAClC,MAAI,KAAJ,UAAA,EAAqB;AACrB,OAAA,UAAA,GAAA,IAAA;AACA,OAAA,IAAA,CAAA,OAAA;AAHFA,CAAAA;;AAMA,IAAIG,IAAI,GAAG,SAAPA,IAAO,GAAW;AACpBV,EAAAA,QAAQ,CAARA,IAAAA,CAAAA,IAAAA;AACA,OAAA,UAAA,GAAA,KAAA;AAFF,CAAA;;AAKAL,IAAI,CAAJA,QAAAA,CAAAA,IAAAA,EAAAA,QAAAA;;AAEAe,IAAI,CAAJA,SAAAA,CAAAA,MAAAA,GAAwB,UAAA,IAAA,EAAA,GAAA,EAAA,EAAA,EAAwB;AAC9CD,EAAAA,EAAE,CAAC,IAAA,KAAA,CAAHA,gCAAG,CAAD,CAAFA;AADFC,CAAAA;;AAIAA,IAAI,CAAJA,SAAAA,CAAAA,OAAAA,GAAyB,YAAW;AAClC,MAAI,KAAJ,UAAA,EAAqB;AACrB,OAAA,UAAA,GAAA,IAAA;AACA,OAAA,IAAA,CAAA,OAAA;AAHFA,CAAAA;;AAMA,IAAIC,IAAI,GAAG,SAAPA,IAAO,CAAA,IAAA,EAAe;AACxB,MAAI,EAAE,gBAAN,IAAI,CAAJ,EAA6B,OAAO,IAAA,IAAA,CAAP,IAAO,CAAP;AAC7BZ,EAAAA,QAAQ,CAARA,IAAAA,CAAAA,IAAAA,EAAAA,IAAAA;AAEA,OAAA,MAAA,GAAA,IAAA;AACA,OAAA,UAAA,GAAA,KAAA;AACA,OAAA,WAAA,GAAA,KAAA;AACA,OAAA,UAAA,GAAA,KAAA;AACA,OAAA,OAAA,GAAA,IAAA;AARF,CAAA;;AAWAJ,IAAI,CAAJA,QAAAA,CAAAA,IAAAA,EAAAA,QAAAA;;AAEAgB,IAAI,CAAJA,SAAAA,CAAAA,KAAAA,GAAuB,UAAA,MAAA,EAAA,MAAA,EAAA,QAAA,EAAmC;AACxD,MAAI,KAAJ,OAAA,EAAkB,MAAM,IAAA,KAAA,CAAN,yBAAM,CAAN;AAClB,MAAI,KAAA,UAAA,IAAmB,KAAvB,UAAA,EAAwC;;AAExC,MAAI,OAAA,MAAA,KAAJ,UAAA,EAAkC;AAChCC,IAAAA,QAAQ,GAARA,MAAAA;AACAC,IAAAA,MAAM,GAANA,IAAAA;AACD;;AAED,MAAI,CAAJ,QAAA,EAAeD,QAAQ,GAARA,IAAAA;AAEf,MAAIN,IAAI,GAAR,IAAA;AAEA,MAAI,CAACQ,MAAM,CAAX,IAAA,EAAmBA,MAAM,CAANA,IAAAA,GAAAA,CAAAA;AACnB,MAAI,CAACA,MAAM,CAAX,IAAA,EAAmBA,MAAM,CAANA,IAAAA,GAAAA,MAAAA;AACnB,MAAI,CAACA,MAAM,CAAX,IAAA,EAAmBA,MAAM,CAANA,IAAAA,GAAcA,MAAM,CAANA,IAAAA,KAAAA,WAAAA,GAAAA,MAAAA,GAAdA,MAAAA;AACnB,MAAI,CAACA,MAAM,CAAX,GAAA,EAAmBA,MAAM,CAANA,GAAAA,GAAAA,CAAAA;AACnB,MAAI,CAACA,MAAM,CAAX,GAAA,EAAmBA,MAAM,CAANA,GAAAA,GAAAA,CAAAA;AACnB,MAAI,CAACA,MAAM,CAAX,KAAA,EAAmBA,MAAM,CAANA,KAAAA,GAAe,IAAfA,IAAe,EAAfA;AAEnB,MAAI,OAAA,MAAA,KAAJ,QAAA,EAAgCD,MAAM,GAAG,IAAA,MAAA,CAATA,MAAS,CAATA;;AAChC,MAAIE,MAAM,CAANA,QAAAA,CAAJ,MAAIA,CAAJ,EAA6B;AAC3BD,IAAAA,MAAM,CAANA,IAAAA,GAAcD,MAAM,CAApBC,MAAAA;;AACA,SAAA,OAAA,CAAA,MAAA;;AACA,SAAA,IAAA,CAAA,MAAA;AACAV,IAAAA,QAAQ,CAAA,IAAA,EAAOU,MAAM,CAArBV,IAAQ,CAARA;AACAY,IAAAA,OAAO,CAAPA,QAAAA,CAAAA,QAAAA;AACA,WAAO,IAAP,IAAO,EAAP;AACD;;AACD,MAAIF,MAAM,CAANA,IAAAA,KAAAA,MAAAA,IAA0BA,MAAM,CAANA,IAAAA,KAA9B,iBAAA,EAAiE;AAC/D,SAAA,OAAA,CAAA,MAAA;;AACAE,IAAAA,OAAO,CAAPA,QAAAA,CAAAA,QAAAA;AACA,WAAO,IAAP,IAAO,EAAP;AACD;;AAED,MAAIC,IAAI,GAAG,IAAA,IAAA,CAAX,IAAW,CAAX;;AAEA,OAAA,OAAA,CAAA,MAAA;;AACA,OAAA,OAAA,GAAA,IAAA;AAEApB,EAAAA,GAAG,CAAA,IAAA,EAAO,UAAA,GAAA,EAAc;AACtBS,IAAAA,IAAI,CAAJA,OAAAA,GAAAA,IAAAA;;AAEA,QAAA,GAAA,EAAS;AAAE;AACTA,MAAAA,IAAI,CAAJA,OAAAA;AACA,aAAOM,QAAQ,CAAf,GAAe,CAAf;AACD;;AAED,QAAIK,IAAI,CAAJA,OAAAA,KAAiBH,MAAM,CAA3B,IAAA,EAAkC;AAAE;AAClCR,MAAAA,IAAI,CAAJA,OAAAA;AACA,aAAOM,QAAQ,CAAC,IAAA,KAAA,CAAhB,eAAgB,CAAD,CAAf;AACD;;AAEDR,IAAAA,QAAQ,CAAA,IAAA,EAAOU,MAAM,CAArBV,IAAQ,CAARA;AACA,QAAIE,IAAI,CAAR,WAAA,EAAsBA,IAAI,CAAJA,QAAAA;AACtBM,IAAAA,QAAQ;AAfVf,GAAG,CAAHA;AAkBA,SAAA,IAAA;AA1DFc,CAAAA;;AA6DAA,IAAI,CAAJA,SAAAA,CAAAA,QAAAA,GAA0B,YAAW;AACnC,MAAI,KAAJ,OAAA,EAAkB;AAChB,SAAA,WAAA,GAAA,IAAA;AACA;AACD;;AAED,MAAI,KAAJ,UAAA,EAAqB;AACrB,OAAA,UAAA,GAAA,IAAA;AACA,OAAA,IAAA,CAAA,UAAA;AACA,OAAA,IAAA,CAAA,IAAA;AATFA,CAAAA;;AAYAA,IAAI,CAAJA,SAAAA,CAAAA,OAAAA,GAAyB,UAAA,GAAA,EAAc;AACrC,MAAI,KAAJ,UAAA,EAAqB;AACrB,OAAA,UAAA,GAAA,IAAA;AAEA,MAAA,GAAA,EAAS,KAAA,IAAA,CAAA,OAAA,EAAA,GAAA;AACT,OAAA,IAAA,CAAA,OAAA;AACA,MAAI,KAAA,OAAA,IAAgB,KAAA,OAAA,CAApB,OAAA,EAA0C,KAAA,OAAA,CAAA,OAAA;AAN5CA,CAAAA;;AASAA,IAAI,CAAJA,SAAAA,CAAAA,OAAAA,GAAyB,UAAA,MAAA,EAAiB;AACxC,MAAIO,GAAG,GAAGpB,OAAO,CAAPA,MAAAA,CAAV,MAAUA,CAAV;AACA,MAAA,GAAA,EAAS,KAAA,IAAA,CAAT,GAAS,EAAT,KACK,KAAA,UAAA,CAAA,MAAA;AAHPa,CAAAA;;AAMAA,IAAI,CAAJA,SAAAA,CAAAA,UAAAA,GAA4B,UAAA,MAAA,EAAiB;AAC3C,MAAIQ,SAAS,GAAG,OAAO,CAAP,SAAA,CAAkB;AAChCC,IAAAA,IAAI,EAAEN,MAAM,CADoB,IAAA;AAEhCO,IAAAA,QAAQ,EAAEP,MAAM,CAACO;AAFe,GAAlB,CAAhB;AAKA,MAAIC,SAAS,GAAG;AACdF,IAAAA,IAAI,EADU,WAAA;AAEdG,IAAAA,IAAI,EAAET,MAAM,CAFE,IAAA;AAGdU,IAAAA,GAAG,EAAEV,MAAM,CAHG,GAAA;AAIdW,IAAAA,GAAG,EAAEX,MAAM,CAJG,GAAA;AAKdT,IAAAA,IAAI,EAAEc,SAAS,CALD,MAAA;AAMdO,IAAAA,KAAK,EAAEZ,MAAM,CANC,KAAA;AAOda,IAAAA,IAAI,EAPU,YAAA;AAQdN,IAAAA,QAAQ,EAAEP,MAAM,CAANA,QAAAA,IARI,WAAA;AASdc,IAAAA,KAAK,EAAEd,MAAM,CATC,KAAA;AAUde,IAAAA,KAAK,EAAEf,MAAM,CAVC,KAAA;AAWdgB,IAAAA,QAAQ,EAAEhB,MAAM,CAXF,QAAA;AAYdiB,IAAAA,QAAQ,EAAEjB,MAAM,CAACiB;AAZH,GAAhB;AAeA,OAAA,IAAA,CAAUjC,OAAO,CAAPA,MAAAA,CAAV,SAAUA,CAAV;AACA,OAAA,IAAA,CAAA,SAAA;AACAM,EAAAA,QAAQ,CAAA,IAAA,EAAOe,SAAS,CAAxBf,MAAQ,CAARA;AAEAkB,EAAAA,SAAS,CAATA,IAAAA,GAAiBR,MAAM,CAAvBQ,IAAAA;AACAA,EAAAA,SAAS,CAATA,IAAAA,GAAiBR,MAAM,CAAvBQ,IAAAA;AACA,OAAA,IAAA,CAAUxB,OAAO,CAAPA,MAAAA,CAAV,SAAUA,CAAV;AA3BFa,CAAAA;;AA8BAA,IAAI,CAAJA,SAAAA,CAAAA,KAAAA,GAAuB,UAAA,CAAA,EAAY;AACjC,MAAIqB,KAAK,GAAG,KAAZ,MAAA;AACA,OAAA,MAAA,GAAA,IAAA;AACAA,EAAAA,KAAK;AAHPrB,CAAAA;;AAMAsB,MAAM,CAANA,OAAAA,GAAAA,IAAAA","sourcesContent":["var util = require('util')\nvar eos = require('end-of-stream')\nvar headers = require('./headers')\n\nvar Readable = require('readable-stream').Readable\nvar Writable = require('readable-stream').Writable\nvar PassThrough = require('readable-stream').PassThrough\n\nvar END_OF_TAR = new Buffer(1024)\nEND_OF_TAR.fill(0)\n\nvar noop = function() {}\n\nvar overflow = function(self, size) {\n  size &= 511\n  if (size) self.push(END_OF_TAR.slice(0, 512 - size))\n}\n\nvar Sink = function(to) {\n  Writable.call(this)\n  this.written = 0\n  this._to = to\n  this._destroyed = false\n}\n\nutil.inherits(Sink, Writable)\n\nSink.prototype._write = function(data, enc, cb) {\n  this.written += data.length\n  if (this._to.push(data)) return cb()\n  this._to._drain = cb\n}\n\nSink.prototype.destroy = function() {\n  if (this._destroyed) return\n  this._destroyed = true\n  this.emit('close')\n}\n\nvar Void = function() {\n  Writable.call(this)\n  this._destroyed = false\n}\n\nutil.inherits(Void, Writable)\n\nVoid.prototype._write = function(data, enc, cb) {\n  cb(new Error('No body allowed for this entry'))\n}\n\nVoid.prototype.destroy = function() {\n  if (this._destroyed) return\n  this._destroyed = true\n  this.emit('close')\n}\n\nvar Pack = function(opts) {\n  if (!(this instanceof Pack)) return new Pack(opts)\n  Readable.call(this, opts)\n\n  this._drain = noop\n  this._finalized = false\n  this._finalizing = false\n  this._destroyed = false\n  this._stream = null\n}\n\nutil.inherits(Pack, Readable)\n\nPack.prototype.entry = function(header, buffer, callback) {\n  if (this._stream) throw new Error('already piping an entry')\n  if (this._finalized || this._destroyed) return\n\n  if (typeof buffer === 'function') {\n    callback = buffer\n    buffer = null\n  }\n\n  if (!callback) callback = noop\n\n  var self = this\n\n  if (!header.size)  header.size = 0\n  if (!header.type)  header.type = 'file'\n  if (!header.mode)  header.mode = header.type === 'directory' ? '0755' : '0644'\n  if (!header.uid)   header.uid = 0\n  if (!header.gid)   header.gid = 0\n  if (!header.mtime) header.mtime = new Date()\n\n  if (typeof buffer === 'string') buffer = new Buffer(buffer)\n  if (Buffer.isBuffer(buffer)) {\n    header.size = buffer.length\n    this._encode(header)\n    this.push(buffer)\n    overflow(self, header.size)\n    process.nextTick(callback)\n    return new Void()\n  }\n  if (header.type !== 'file' && header.type !== 'contigious-file') {\n    this._encode(header)\n    process.nextTick(callback)\n    return new Void()\n  }\n\n  var sink = new Sink(this)\n\n  this._encode(header)\n  this._stream = sink\n\n  eos(sink, function(err) {\n    self._stream = null\n\n    if (err) { // stream was closed\n      self.destroy()\n      return callback(err)\n    }\n\n    if (sink.written !== header.size) { // corrupting tar\n      self.destroy()\n      return callback(new Error('size mismatch'))\n    }\n\n    overflow(self, header.size)\n    if (self._finalizing) self.finalize()\n    callback()\n  })\n\n  return sink\n}\n\nPack.prototype.finalize = function() {\n  if (this._stream) {\n    this._finalizing = true\n    return\n  }\n\n  if (this._finalized) return\n  this._finalized = true\n  this.push(END_OF_TAR)\n  this.push(null)\n}\n\nPack.prototype.destroy = function(err) {\n  if (this._destroyed) return\n  this._destroyed = true\n\n  if (err) this.emit('error', err)\n  this.emit('close')\n  if (this._stream && this._stream.destroy) this._stream.destroy()\n}\n\nPack.prototype._encode = function(header) {\n  var buf = headers.encode(header)\n  if (buf) this.push(buf)\n  else this._encodePax(header)\n}\n\nPack.prototype._encodePax = function(header) {\n  var paxHeader = headers.encodePax({\n    name: header.name,\n    linkname: header.linkname\n  })\n\n  var newHeader = {\n    name: 'PaxHeader',\n    mode: header.mode,\n    uid: header.uid,\n    gid: header.gid,\n    size: paxHeader.length,\n    mtime: header.mtime,\n    type: 'pax-header',\n    linkname: header.linkname && 'PaxHeader',\n    uname: header.uname,\n    gname: header.gname,\n    devmajor: header.devmajor,\n    devminor: header.devminor\n  }\n\n  this.push(headers.encode(newHeader))\n  this.push(paxHeader)\n  overflow(this, paxHeader.length)\n\n  newHeader.size = header.size\n  newHeader.type = header.type\n  this.push(headers.encode(newHeader))\n}\n\nPack.prototype._read = function(n) {\n  var drain = this._drain\n  this._drain = noop\n  drain()\n}\n\nmodule.exports = Pack\n"],"file":"pack.js"}