{"version":3,"sources":["../node_modules/readdirp/stream-api.js"],"names":["stream","require","util","Readable","module","opts","proto","ReaddirpReadable","self","setImmediate","processEntry","done","handleError","handleFatalError"],"mappings":"AAAA;;AAEA,IAAIA,MAAM,GAAGC,OAAO,CAApB,iBAAoB,CAApB;;AACA,IAAIC,IAAI,GAAGD,OAAO,CAAlB,MAAkB,CAAlB;;AAEA,IAAIE,QAAQ,GAAGH,MAAM,CAArB,QAAA;AAEAI,MAAM,CAANA,OAAAA,GAAAA,gBAAAA;AAEAF,IAAI,CAAJA,QAAAA,CAAAA,gBAAAA,EAAAA,QAAAA;;AAEA,SAAA,gBAAA,CAAA,IAAA,EAAiC;AAC/B,MAAI,EAAE,gBAAN,gBAAI,CAAJ,EAAyC,OAAO,IAAA,gBAAA,CAAP,IAAO,CAAP;AAEzCG,EAAAA,IAAI,GAAGA,IAAI,IAAXA,EAAAA;AAEAA,EAAAA,IAAI,CAAJA,UAAAA,GAAAA,IAAAA;AACAF,EAAAA,QAAQ,CAARA,IAAAA,CAAAA,IAAAA,EAN+B,IAM/BA,EAN+B,CAQ/B;;AACA,OAAA,aAAA,GAAA,QAAA;AAEA,OAAA,UAAA,GAAA,KAAA;AACA,OAAA,OAAA,GAAA,KAAA;AACA,OAAA,SAAA,GAAA,EAAA;AACA,OAAA,OAAA,GAAA,EAAA;;AAEA,OAAA,kBAAA;AACD;;AAED,IAAIG,KAAK,GAAGC,gBAAgB,CAA5B,SAAA;;AAEAD,KAAK,CAALA,kBAAAA,GAA2B,YAAY;AACrC,MAAIE,IAAI,GAAR,IAAA;AACAA,EAAAA,IAAI,CAAJA,EAAAA,CAAAA,OAAAA,EAAiB,YAAY;AAAEA,IAAAA,IAAI,CAAJA,OAAAA,GAAAA,IAAAA;AAA/BA,GAAAA;AACAA,EAAAA,IAAI,CAAJA,EAAAA,CAAAA,QAAAA,EAAkB,YAAY;AAC5B,QAAIA,IAAI,CAAR,UAAA,EAAqB;AACrBA,IAAAA,IAAI,CAAJA,OAAAA,GAAAA,KAAAA;;AAEAA,IAAAA,IAAI,CAAJA,SAAAA,CAAAA,OAAAA,CAAuB,UAAA,GAAA,EAAe;AAAEA,MAAAA,IAAI,CAAJA,IAAAA,CAAAA,MAAAA,EAAAA,GAAAA;AAAxCA,KAAAA;;AACAA,IAAAA,IAAI,CAAJA,SAAAA,CAAAA,MAAAA,GAAAA,CAAAA;;AAEAA,IAAAA,IAAI,CAAJA,OAAAA,CAAAA,OAAAA,CAAqB,UAAA,GAAA,EAAe;AAAEA,MAAAA,IAAI,CAAJA,IAAAA,CAAAA,OAAAA,EAAAA,GAAAA;AAAtCA,KAAAA;;AACAA,IAAAA,IAAI,CAAJA,OAAAA,CAAAA,MAAAA,GAAAA,CAAAA;AARFA,GAAAA;AAHFF,CAAAA,C,CAeA;;;AACAA,KAAK,CAALA,aAAAA,GAAsB,UAAA,KAAA,EAAiB;AACrC,MAAI,KAAJ,UAAA,EAAqB;AACrB,OAAA,IAAA,CAAA,KAAA;AAFFA,CAAAA;;AAKAA,KAAK,CAALA,KAAAA,GAAc,YAAY,CAA1BA,CAAAA;;AAEAA,KAAK,CAALA,OAAAA,GAAgB,YAAY;AAC1B;AACA,OAAA,IAAA,CAAA,IAAA;AACA,OAAA,QAAA,GAAA,KAAA;AACA,OAAA,UAAA,GAAA,IAAA;AACA,OAAA,IAAA,CAAA,OAAA;AALFA,CAAAA;;AAQAA,KAAK,CAALA,KAAAA,GAAc,YAAY;AACxB,OAAA,IAAA,CAAA,IAAA;AADFA,CAAAA,C,CAIA;AACA;;;AACAA,KAAK,CAALA,YAAAA,GAAqB,UAAA,GAAA,EAAe;AAClC,MAAIE,IAAI,GAAR,IAAA;AACAC,EAAAA,YAAY,CAAC,YAAY;AACvB,QAAID,IAAI,CAAR,OAAA,EAAkB,OAAOA,IAAI,CAAJA,SAAAA,CAAAA,IAAAA,CAAP,GAAOA,CAAP;AAClB,QAAI,CAACA,IAAI,CAAT,UAAA,EAAsBA,IAAI,CAAJA,IAAAA,CAAAA,MAAAA,EAAAA,GAAAA;AAFxBC,GAAY,CAAZA;AAFFH,CAAAA;;AAQAA,KAAK,CAALA,iBAAAA,GAA0B,UAAA,GAAA,EAAe;AACvC,MAAIE,IAAI,GAAR,IAAA;AACAC,EAAAA,YAAY,CAAC,YAAY;AACvB,QAAID,IAAI,CAAR,OAAA,EAAkB,OAAOA,IAAI,CAAJA,OAAAA,CAAAA,IAAAA,CAAP,GAAOA,CAAP;AAClB,QAAI,CAACA,IAAI,CAAT,UAAA,EAAsBA,IAAI,CAAJA,IAAAA,CAAAA,OAAAA,EAAAA,GAAAA;AAFxBC,GAAY,CAAZA;AAFFH,CAAAA;;AAQA,SAAA,eAAA,GAA4B;AAC1B,MAAIN,MAAM,GAAG,IAAb,gBAAa,EAAb;AAEA,SAAO;AACHA,IAAAA,MAAM,EADH,MAAA;AAEHU,IAAAA,YAAY,EAAQV,MAAM,CAANA,aAAAA,CAAAA,IAAAA,CAFjB,MAEiBA,CAFjB;AAGHW,IAAAA,IAAI,EAAgBX,MAAM,CAANA,KAAAA,CAAAA,IAAAA,CAHjB,MAGiBA,CAHjB;AAIHY,IAAAA,WAAW,EAASZ,MAAM,CAANA,YAAAA,CAAAA,IAAAA,CAJjB,MAIiBA,CAJjB;AAKHa,IAAAA,gBAAgB,EAAIb,MAAM,CAANA,iBAAAA,CAAAA,IAAAA,CAAAA,MAAAA;AALjB,GAAP;AAOD;;AAEDI,MAAM,CAANA,OAAAA,GAAAA,eAAAA","sourcesContent":["'use strict';\n\nvar stream = require('readable-stream');\nvar util = require('util');\n\nvar Readable = stream.Readable;\n\nmodule.exports = ReaddirpReadable;\n\nutil.inherits(ReaddirpReadable, Readable);\n\nfunction ReaddirpReadable (opts) {\n  if (!(this instanceof ReaddirpReadable)) return new ReaddirpReadable(opts);\n\n  opts = opts || {};\n\n  opts.objectMode = true;\n  Readable.call(this, opts);\n\n  // backpressure not implemented at this point\n  this.highWaterMark = Infinity;\n\n  this._destroyed = false;\n  this._paused = false;\n  this._warnings = [];\n  this._errors = [];\n\n  this._pauseResumeErrors();\n}\n\nvar proto = ReaddirpReadable.prototype;\n\nproto._pauseResumeErrors = function () {\n  var self = this;\n  self.on('pause', function () { self._paused = true });\n  self.on('resume', function () {\n    if (self._destroyed) return;\n    self._paused = false;\n\n    self._warnings.forEach(function (err) { self.emit('warn', err) });\n    self._warnings.length = 0;\n\n    self._errors.forEach(function (err) { self.emit('error', err) });\n    self._errors.length = 0;\n  })\n}\n\n// called for each entry\nproto._processEntry = function (entry) {\n  if (this._destroyed) return;\n  this.push(entry);\n}\n\nproto._read = function () { }\n\nproto.destroy = function () {\n  // when stream is destroyed it will emit nothing further, not even errors or warnings\n  this.push(null);\n  this.readable = false;\n  this._destroyed = true;\n  this.emit('close');\n}\n\nproto._done = function () {\n  this.push(null);\n}\n\n// we emit errors and warnings async since we may handle errors like invalid args\n// within the initial event loop before any event listeners subscribed\nproto._handleError = function (err) {\n  var self = this;\n  setImmediate(function () {\n    if (self._paused) return self._warnings.push(err);\n    if (!self._destroyed) self.emit('warn', err);\n  });\n}\n\nproto._handleFatalError = function (err) {\n  var self = this;\n  setImmediate(function () {\n    if (self._paused) return self._errors.push(err);\n    if (!self._destroyed) self.emit('error', err);\n  });\n}\n\nfunction createStreamAPI () {\n  var stream = new ReaddirpReadable();\n\n  return {\n      stream           :  stream\n    , processEntry     :  stream._processEntry.bind(stream)\n    , done             :  stream._done.bind(stream)\n    , handleError      :  stream._handleError.bind(stream)\n    , handleFatalError :  stream._handleFatalError.bind(stream)\n  };\n}\n\nmodule.exports = createStreamAPI;\n"],"file":"stream-api.js"}